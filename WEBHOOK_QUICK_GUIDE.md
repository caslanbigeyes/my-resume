# ğŸš€ Webhookè‡ªåŠ¨éƒ¨ç½²æœåŠ¡ - å¿«é€ŸæŒ‡å—

## âœ… æœåŠ¡çŠ¶æ€

WebhookæœåŠ¡å·²æˆåŠŸéƒ¨ç½²å¹¶è¿è¡Œåœ¨ï¼š**http://47.116.219.238:3001**

## ğŸ”— GitHub Webhooké…ç½®

### 1. åœ¨GitHubä»“åº“ä¸­æ·»åŠ Webhook

1. æ‰“å¼€ä½ çš„GitHubä»“åº“
2. è¿›å…¥ `Settings` â†’ `Webhooks`
3. ç‚¹å‡» `Add webhook`
4. å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š

```
Payload URL: http://47.116.219.238:3001/webhook
Content type: application/json
Secret: (å¯é€‰ï¼Œç•™ç©ºå³å¯)
Events: Just the push event
Active: âœ… å‹¾é€‰
```

5. ç‚¹å‡» `Add webhook`

### 2. æµ‹è¯•è‡ªåŠ¨éƒ¨ç½²

æ¨é€ä»£ç åˆ° `main` æˆ– `master` åˆ†æ”¯ï¼Œwebhookä¼šè‡ªåŠ¨è§¦å‘éƒ¨ç½²ã€‚

## ğŸ“‹ å¯ç”¨ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | ç¤ºä¾‹ |
|------|------|------|------|
| `/webhook` | POST | GitHub webhookå¤„ç† | GitHubè‡ªåŠ¨è°ƒç”¨ |
| `/deploy` | POST | æ‰‹åŠ¨è§¦å‘éƒ¨ç½² | `curl -X POST http://47.116.219.238:3001/deploy` |
| `/status` | GET | æŸ¥çœ‹æœåŠ¡çŠ¶æ€ | `curl http://47.116.219.238:3001/status` |
| `/logs` | GET | æŸ¥çœ‹éƒ¨ç½²æ—¥å¿— | `curl http://47.116.219.238:3001/logs` |
| `/` | GET | å¸®åŠ©ä¿¡æ¯ | `curl http://47.116.219.238:3001/` |

## ğŸ§ª å¿«é€Ÿæµ‹è¯•

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://47.116.219.238:3001/status

# æ‰‹åŠ¨è§¦å‘éƒ¨ç½²
curl -X POST http://47.116.219.238:3001/deploy

# æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
curl http://47.116.219.238:3001/logs
```

## ğŸ”„ éƒ¨ç½²æµç¨‹

å½“æ”¶åˆ°GitHubæ¨é€æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š

1. âœ… éªŒè¯æ˜¯å¦ä¸ºmain/masteråˆ†æ”¯
2. ğŸ“¥ æ‹‰å–æœ€æ–°ä»£ç 
3. ğŸ“¦ å®‰è£…ä¾èµ– (`npm install`)
4. ğŸ—ï¸ æ„å»ºé¡¹ç›® (`npm run build`)
5. ğŸ”„ é‡å¯åº”ç”¨ (PM2)
6. âœ… éªŒè¯éƒ¨ç½²æˆåŠŸ

## ğŸ› ï¸ æœåŠ¡ç®¡ç†

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
ssh root@47.116.219.238
pm2 list
```

### é‡å¯webhookæœåŠ¡
```bash
pm2 restart webhook-server
```

### æŸ¥çœ‹æ—¥å¿—
```bash
pm2 logs webhook-server
```

## ğŸ¯ ä½¿ç”¨åœºæ™¯

- âœ… æ¨é€åˆ°mainåˆ†æ”¯ â†’ è‡ªåŠ¨éƒ¨ç½²
- âœ… æ‰‹åŠ¨è§¦å‘éƒ¨ç½² â†’ è°ƒç”¨ `/deploy` ç«¯ç‚¹
- âœ… ç›‘æ§æœåŠ¡çŠ¶æ€ â†’ è°ƒç”¨ `/status` ç«¯ç‚¹
- âœ… æŸ¥çœ‹éƒ¨ç½²æ—¥å¿— â†’ è°ƒç”¨ `/logs` ç«¯ç‚¹

## ğŸ”’ å®‰å…¨è¯´æ˜

- æœåŠ¡è¿è¡Œåœ¨ç«¯å£3001ï¼Œå·²é…ç½®é˜²ç«å¢™
- æ”¯æŒGitHub webhookç­¾åéªŒè¯ï¼ˆå¯é€‰ï¼‰
- åªå¤„ç†main/masteråˆ†æ”¯çš„æ¨é€äº‹ä»¶

## ğŸ“ æ•…éšœæ’é™¤

å¦‚æœwebhookä¸å·¥ä½œï¼Œè¯·æ£€æŸ¥ï¼š

1. **GitHub webhooké…ç½®æ˜¯å¦æ­£ç¡®**
2. **æœåŠ¡æ˜¯å¦è¿è¡Œ**: `curl http://47.116.219.238:3001/status`
3. **æŸ¥çœ‹é”™è¯¯æ—¥å¿—**: `curl http://47.116.219.238:3001/logs`
4. **PM2è¿›ç¨‹çŠ¶æ€**: SSHåˆ°æœåŠ¡å™¨è¿è¡Œ `pm2 list`

---

ğŸ‰ **æ­å–œï¼** ä½ çš„è‡ªåŠ¨éƒ¨ç½²ç³»ç»Ÿå·²ç»é…ç½®å®Œæˆï¼Œç°åœ¨å¯ä»¥äº«å—ä»£ç æ¨é€å³éƒ¨ç½²çš„ä¾¿åˆ©äº†ï¼