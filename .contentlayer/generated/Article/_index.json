[
  {
    "title": "Next.js App Router å®Œå…¨æŒ‡å—",
    "excerpt": "å…¨é¢ä»‹ç» Next.js 14 çš„ App Routerï¼ŒåŒ…æ‹¬è·¯ç”±ç³»ç»Ÿã€å¸ƒå±€ã€åŠ è½½çŠ¶æ€ã€é”™è¯¯å¤„ç†ç­‰æ ¸å¿ƒæ¦‚å¿µå’Œæœ€ä½³å®è·µã€‚",
    "publishedAt": "2024-02-01T00:00:00.000Z",
    "author": "li-lingfeng",
    "category": "frontend",
    "tags": [
      "nextjs",
      "react",
      "typescript"
    ],
    "featured": true,
    "published": true,
    "image": "/images/articles/nextjs-app-router.jpg",
    "seoTitle": "Next.js App Router å®Œå…¨æŒ‡å— - æŒæ¡æ–°ä¸€ä»£è·¯ç”±ç³»ç»Ÿ",
    "seoDescription": "å­¦ä¹  Next.js 14 App Router çš„æ ¸å¿ƒæ¦‚å¿µå’Œæœ€ä½³å®è·µï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿè·¯ç”±ã€å¸ƒå±€ã€æœåŠ¡å™¨ç»„ä»¶ç­‰",
    "seoKeywords": [
      "Next.js",
      "App Router",
      "React Server Components",
      "æ–‡ä»¶ç³»ç»Ÿè·¯ç”±"
    ],
    "body": {
      "raw": "\n# Next.js App Router å®Œå…¨æŒ‡å—\n\nNext.js 13 å¼•å…¥äº†å…¨æ–°çš„ App Routerï¼Œè¿™æ˜¯åŸºäº React Server Components æ„å»ºçš„ä¸‹ä¸€ä»£è·¯ç”±ç³»ç»Ÿã€‚æœ¬æ–‡å°†å…¨é¢ä»‹ç» App Router çš„æ ¸å¿ƒæ¦‚å¿µå’Œæœ€ä½³å®è·µã€‚\n\n## App Router vs Pages Router\n\n### Pages Router (ä¼ ç»Ÿæ–¹å¼)\n```\npages/\nâ”œâ”€â”€ index.js          // /\nâ”œâ”€â”€ about.js          // /about\nâ””â”€â”€ blog/\n    â”œâ”€â”€ index.js      // /blog\n    â””â”€â”€ [slug].js     // /blog/[slug]\n```\n\n### App Router (æ–°æ–¹å¼)\n```\napp/\nâ”œâ”€â”€ page.tsx          // /\nâ”œâ”€â”€ about/\nâ”‚   â””â”€â”€ page.tsx      // /about\nâ””â”€â”€ blog/\n    â”œâ”€â”€ page.tsx      // /blog\n    â””â”€â”€ [slug]/\n        â””â”€â”€ page.tsx  // /blog/[slug]\n```\n\n## æ ¸å¿ƒæ¦‚å¿µ\n\n### 1. æ–‡ä»¶çº¦å®š\n\nApp Router ä½¿ç”¨ç‰¹æ®Šçš„æ–‡ä»¶åæ¥å®šä¹‰è·¯ç”±è¡Œä¸ºï¼š\n\n- `page.tsx`: å®šä¹‰è·¯ç”±é¡µé¢\n- `layout.tsx`: å®šä¹‰å¸ƒå±€\n- `loading.tsx`: å®šä¹‰åŠ è½½çŠ¶æ€\n- `error.tsx`: å®šä¹‰é”™è¯¯é¡µé¢\n- `not-found.tsx`: å®šä¹‰ 404 é¡µé¢\n- `route.tsx`: å®šä¹‰ API è·¯ç”±\n\n### 2. å¸ƒå±€ç³»ç»Ÿ\n\n#### æ ¹å¸ƒå±€ (å¿…éœ€)\n\n```tsx\n// app/layout.tsx\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <html lang=\"zh\">\n      <body>\n        <header>\n          <nav>å…¨å±€å¯¼èˆª</nav>\n        </header>\n        <main>{children}</main>\n        <footer>å…¨å±€é¡µè„š</footer>\n      </body>\n    </html>\n  );\n}\n```\n\n#### åµŒå¥—å¸ƒå±€\n\n```tsx\n// app/blog/layout.tsx\nexport default function BlogLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <div className=\"blog-container\">\n      <aside>\n        <h2>åšå®¢ä¾§è¾¹æ </h2>\n        <nav>åšå®¢å¯¼èˆª</nav>\n      </aside>\n      <div className=\"blog-content\">\n        {children}\n      </div>\n    </div>\n  );\n}\n```\n\n### 3. é¡µé¢ç»„ä»¶\n\n```tsx\n// app/blog/page.tsx\nexport default function BlogPage() {\n  return (\n    <div>\n      <h1>åšå®¢é¦–é¡µ</h1>\n      <p>æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢</p>\n    </div>\n  );\n}\n```\n\n### 4. åŠ¨æ€è·¯ç”±\n\n#### å•ä¸ªåŠ¨æ€æ®µ\n\n```tsx\n// app/blog/[slug]/page.tsx\nexport default function BlogPost({\n  params,\n}: {\n  params: { slug: string };\n}) {\n  return (\n    <div>\n      <h1>æ–‡ç« : {params.slug}</h1>\n    </div>\n  );\n}\n```\n\n#### å¤šä¸ªåŠ¨æ€æ®µ\n\n```tsx\n// app/blog/[category]/[slug]/page.tsx\nexport default function CategoryPost({\n  params,\n}: {\n  params: { category: string; slug: string };\n}) {\n  return (\n    <div>\n      <h1>åˆ†ç±»: {params.category}</h1>\n      <h2>æ–‡ç« : {params.slug}</h2>\n    </div>\n  );\n}\n```\n\n#### æ•è·æ‰€æœ‰è·¯ç”±\n\n```tsx\n// app/docs/[...slug]/page.tsx\nexport default function DocsPage({\n  params,\n}: {\n  params: { slug: string[] };\n}) {\n  return (\n    <div>\n      <h1>æ–‡æ¡£è·¯å¾„: {params.slug.join('/')}</h1>\n    </div>\n  );\n}\n```\n\n## æœåŠ¡å™¨ç»„ä»¶ vs å®¢æˆ·ç«¯ç»„ä»¶\n\n### æœåŠ¡å™¨ç»„ä»¶ (é»˜è®¤)\n\n```tsx\n// è¿™æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ç»„ä»¶\nasync function BlogPost({ params }: { params: { slug: string } }) {\n  // å¯ä»¥ç›´æ¥åœ¨æœåŠ¡å™¨ç«¯è·å–æ•°æ®\n  const post = await getPost(params.slug);\n\n  return (\n    <article>\n      <h1>{post.title}</h1>\n      <p>{post.content}</p>\n    </article>\n  );\n}\n```\n\n### å®¢æˆ·ç«¯ç»„ä»¶\n\n```tsx\n'use client'; // æ ‡è®°ä¸ºå®¢æˆ·ç«¯ç»„ä»¶\n\nimport { useState } from 'react';\n\nexport default function Counter() {\n  const [count, setCount] = useState(0);\n\n  return (\n    <div>\n      <p>è®¡æ•°: {count}</p>\n      <button onClick={() => setCount(count + 1)}>\n        å¢åŠ \n      </button>\n    </div>\n  );\n}\n```\n\n## æ•°æ®è·å–\n\n### æœåŠ¡å™¨ç«¯æ•°æ®è·å–\n\n```tsx\n// app/posts/page.tsx\nasync function getPosts() {\n  const res = await fetch('https://api.example.com/posts', {\n    // å¯ä»¥é…ç½®ç¼“å­˜ç­–ç•¥\n    next: { revalidate: 3600 } // 1å°æ—¶åé‡æ–°éªŒè¯\n  });\n\n  if (!res.ok) {\n    throw new Error('Failed to fetch posts');\n  }\n\n  return res.json();\n}\n\nexport default async function PostsPage() {\n  const posts = await getPosts();\n\n  return (\n    <div>\n      <h1>æ–‡ç« åˆ—è¡¨</h1>\n      {posts.map((post: any) => (\n        <div key={post.id}>\n          <h2>{post.title}</h2>\n          <p>{post.excerpt}</p>\n        </div>\n      ))}\n    </div>\n  );\n}\n```\n\n### å¹¶è¡Œæ•°æ®è·å–\n\n```tsx\nasync function getUser(id: string) {\n  const res = await fetch(`/api/users/${id}`);\n  return res.json();\n}\n\nasync function getUserPosts(id: string) {\n  const res = await fetch(`/api/users/${id}/posts`);\n  return res.json();\n}\n\nexport default async function UserProfile({\n  params,\n}: {\n  params: { id: string };\n}) {\n  // å¹¶è¡Œè·å–æ•°æ®\n  const [user, posts] = await Promise.all([\n    getUser(params.id),\n    getUserPosts(params.id),\n  ]);\n\n  return (\n    <div>\n      <h1>{user.name}</h1>\n      <div>\n        <h2>ç”¨æˆ·æ–‡ç« </h2>\n        {posts.map((post: any) => (\n          <div key={post.id}>{post.title}</div>\n        ))}\n      </div>\n    </div>\n  );\n}\n```\n\n## åŠ è½½çŠ¶æ€\n\n```tsx\n// app/blog/loading.tsx\nexport default function Loading() {\n  return (\n    <div className=\"loading-container\">\n      <div className=\"spinner\"></div>\n      <p>åŠ è½½ä¸­...</p>\n    </div>\n  );\n}\n```\n\n## é”™è¯¯å¤„ç†\n\n```tsx\n// app/blog/error.tsx\n'use client';\n\nexport default function Error({\n  error,\n  reset,\n}: {\n  error: Error & { digest?: string };\n  reset: () => void;\n}) {\n  return (\n    <div className=\"error-container\">\n      <h2>å‡ºé”™äº†ï¼</h2>\n      <p>{error.message}</p>\n      <button onClick={reset}>é‡è¯•</button>\n    </div>\n  );\n}\n```\n\n## è·¯ç”±ç»„\n\nä½¿ç”¨æ‹¬å·åˆ›å»ºè·¯ç”±ç»„ï¼Œä¸å½±å“ URL ç»“æ„ï¼š\n\n```\napp/\nâ”œâ”€â”€ (marketing)/\nâ”‚   â”œâ”€â”€ about/\nâ”‚   â”‚   â””â”€â”€ page.tsx     // /about\nâ”‚   â””â”€â”€ contact/\nâ”‚       â””â”€â”€ page.tsx     // /contact\nâ””â”€â”€ (shop)/\n    â”œâ”€â”€ products/\n    â”‚   â””â”€â”€ page.tsx     // /products\n    â””â”€â”€ cart/\n        â””â”€â”€ page.tsx     // /cart\n```\n\næ¯ä¸ªè·¯ç”±ç»„å¯ä»¥æœ‰è‡ªå·±çš„å¸ƒå±€ï¼š\n\n```tsx\n// app/(marketing)/layout.tsx\nexport default function MarketingLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <div className=\"marketing-layout\">\n      <nav>è¥é”€é¡µé¢å¯¼èˆª</nav>\n      {children}\n    </div>\n  );\n}\n```\n\n## æ‹¦æˆªè·¯ç”±\n\nä½¿ç”¨ `(..)` è¯­æ³•æ‹¦æˆªè·¯ç”±ï¼š\n\n```\napp/\nâ”œâ”€â”€ feed/\nâ”‚   â””â”€â”€ page.tsx\nâ”œâ”€â”€ photo/\nâ”‚   â””â”€â”€ [id]/\nâ”‚       â””â”€â”€ page.tsx\nâ””â”€â”€ @modal/\n    â””â”€â”€ (..)photo/\n        â””â”€â”€ [id]/\n            â””â”€â”€ page.tsx\n```\n\n## å¹¶è¡Œè·¯ç”±\n\nä½¿ç”¨ `@` è¯­æ³•åˆ›å»ºå¹¶è¡Œè·¯ç”±ï¼š\n\n```tsx\n// app/layout.tsx\nexport default function Layout({\n  children,\n  analytics,\n  team,\n}: {\n  children: React.ReactNode;\n  analytics: React.ReactNode;\n  team: React.ReactNode;\n}) {\n  return (\n    <>\n      {children}\n      {analytics}\n      {team}\n    </>\n  );\n}\n```\n\n## æœ€ä½³å®è·µ\n\n### 1. åˆç†ä½¿ç”¨æœåŠ¡å™¨ç»„ä»¶å’Œå®¢æˆ·ç«¯ç»„ä»¶\n\n```tsx\n// æœåŠ¡å™¨ç»„ä»¶è´Ÿè´£æ•°æ®è·å–\nasync function PostList() {\n  const posts = await getPosts();\n\n  return (\n    <div>\n      {posts.map(post => (\n        <PostCard key={post.id} post={post} />\n      ))}\n    </div>\n  );\n}\n\n// å®¢æˆ·ç«¯ç»„ä»¶è´Ÿè´£äº¤äº’\n'use client';\nfunction PostCard({ post }) {\n  const [liked, setLiked] = useState(false);\n\n  return (\n    <div>\n      <h3>{post.title}</h3>\n      <button onClick={() => setLiked(!liked)}>\n        {liked ? 'â¤ï¸' : 'ğŸ¤'}\n      </button>\n    </div>\n  );\n}\n```\n\n### 2. ä¼˜åŒ–æ•°æ®è·å–\n\n```tsx\n// ä½¿ç”¨é€‚å½“çš„ç¼“å­˜ç­–ç•¥\nasync function getData() {\n  const res = await fetch('https://api.example.com/data', {\n    next: {\n      revalidate: 3600, // é™æ€é‡æ–°ç”Ÿæˆ\n      tags: ['posts'] // æ ‡ç­¾é‡æ–°éªŒè¯\n    }\n  });\n\n  return res.json();\n}\n```\n\n### 3. é”™è¯¯è¾¹ç•Œå’ŒåŠ è½½çŠ¶æ€\n\nä¸ºæ¯ä¸ªè·¯ç”±æ®µæä¾›é€‚å½“çš„é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€ï¼š\n\n```\napp/\nâ”œâ”€â”€ dashboard/\nâ”‚   â”œâ”€â”€ loading.tsx      // ä»ªè¡¨æ¿åŠ è½½çŠ¶æ€\nâ”‚   â”œâ”€â”€ error.tsx        // ä»ªè¡¨æ¿é”™è¯¯å¤„ç†\nâ”‚   â”œâ”€â”€ page.tsx\nâ”‚   â””â”€â”€ analytics/\nâ”‚       â”œâ”€â”€ loading.tsx  // åˆ†æé¡µé¢åŠ è½½çŠ¶æ€\nâ”‚       â”œâ”€â”€ error.tsx    // åˆ†æé¡µé¢é”™è¯¯å¤„ç†\nâ”‚       â””â”€â”€ page.tsx\n```\n\n## æ€»ç»“\n\nNext.js App Router å¸¦æ¥äº†è®¸å¤šå¼ºå¤§çš„ç‰¹æ€§ï¼š\n\n- **åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„è·¯ç”±**: ç›´è§‚çš„è·¯ç”±ç»“æ„\n- **å¸ƒå±€ç³»ç»Ÿ**: çµæ´»çš„åµŒå¥—å¸ƒå±€\n- **æœåŠ¡å™¨ç»„ä»¶**: æ›´å¥½çš„æ€§èƒ½å’Œ SEO\n- **æµå¼æ¸²æŸ“**: æ”¹å–„ç”¨æˆ·ä½“éªŒ\n- **å¹¶è¡Œè·¯ç”±**: å¤æ‚ UI çš„è§£å†³æ–¹æ¡ˆ\n\nApp Router ä»£è¡¨äº† React å’Œ Next.js çš„æœªæ¥æ–¹å‘ï¼Œå€¼å¾—æˆ‘ä»¬æ·±å…¥å­¦ä¹ å’Œå®è·µã€‚\n",
      "html": "<h1>Next.js App Router å®Œå…¨æŒ‡å—</h1>\n<p>Next.js 13 å¼•å…¥äº†å…¨æ–°çš„ App Routerï¼Œè¿™æ˜¯åŸºäº React Server Components æ„å»ºçš„ä¸‹ä¸€ä»£è·¯ç”±ç³»ç»Ÿã€‚æœ¬æ–‡å°†å…¨é¢ä»‹ç» App Router çš„æ ¸å¿ƒæ¦‚å¿µå’Œæœ€ä½³å®è·µã€‚</p>\n<h2>App Router vs Pages Router</h2>\n<h3>Pages Router (ä¼ ç»Ÿæ–¹å¼)</h3>\n<pre><code>pages/\nâ”œâ”€â”€ index.js          // /\nâ”œâ”€â”€ about.js          // /about\nâ””â”€â”€ blog/\n    â”œâ”€â”€ index.js      // /blog\n    â””â”€â”€ [slug].js     // /blog/[slug]\n</code></pre>\n<h3>App Router (æ–°æ–¹å¼)</h3>\n<pre><code>app/\nâ”œâ”€â”€ page.tsx          // /\nâ”œâ”€â”€ about/\nâ”‚   â””â”€â”€ page.tsx      // /about\nâ””â”€â”€ blog/\n    â”œâ”€â”€ page.tsx      // /blog\n    â””â”€â”€ [slug]/\n        â””â”€â”€ page.tsx  // /blog/[slug]\n</code></pre>\n<h2>æ ¸å¿ƒæ¦‚å¿µ</h2>\n<h3>1. æ–‡ä»¶çº¦å®š</h3>\n<p>App Router ä½¿ç”¨ç‰¹æ®Šçš„æ–‡ä»¶åæ¥å®šä¹‰è·¯ç”±è¡Œä¸ºï¼š</p>\n<ul>\n<li><code>page.tsx</code>: å®šä¹‰è·¯ç”±é¡µé¢</li>\n<li><code>layout.tsx</code>: å®šä¹‰å¸ƒå±€</li>\n<li><code>loading.tsx</code>: å®šä¹‰åŠ è½½çŠ¶æ€</li>\n<li><code>error.tsx</code>: å®šä¹‰é”™è¯¯é¡µé¢</li>\n<li><code>not-found.tsx</code>: å®šä¹‰ 404 é¡µé¢</li>\n<li><code>route.tsx</code>: å®šä¹‰ API è·¯ç”±</li>\n</ul>\n<h3>2. å¸ƒå±€ç³»ç»Ÿ</h3>\n<h4>æ ¹å¸ƒå±€ (å¿…éœ€)</h4>\n<pre><code class=\"language-tsx\">// app/layout.tsx\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    &#x3C;html lang=\"zh\">\n      &#x3C;body>\n        &#x3C;header>\n          &#x3C;nav>å…¨å±€å¯¼èˆª&#x3C;/nav>\n        &#x3C;/header>\n        &#x3C;main>{children}&#x3C;/main>\n        &#x3C;footer>å…¨å±€é¡µè„š&#x3C;/footer>\n      &#x3C;/body>\n    &#x3C;/html>\n  );\n}\n</code></pre>\n<h4>åµŒå¥—å¸ƒå±€</h4>\n<pre><code class=\"language-tsx\">// app/blog/layout.tsx\nexport default function BlogLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    &#x3C;div className=\"blog-container\">\n      &#x3C;aside>\n        &#x3C;h2>åšå®¢ä¾§è¾¹æ &#x3C;/h2>\n        &#x3C;nav>åšå®¢å¯¼èˆª&#x3C;/nav>\n      &#x3C;/aside>\n      &#x3C;div className=\"blog-content\">\n        {children}\n      &#x3C;/div>\n    &#x3C;/div>\n  );\n}\n</code></pre>\n<h3>3. é¡µé¢ç»„ä»¶</h3>\n<pre><code class=\"language-tsx\">// app/blog/page.tsx\nexport default function BlogPage() {\n  return (\n    &#x3C;div>\n      &#x3C;h1>åšå®¢é¦–é¡µ&#x3C;/h1>\n      &#x3C;p>æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢&#x3C;/p>\n    &#x3C;/div>\n  );\n}\n</code></pre>\n<h3>4. åŠ¨æ€è·¯ç”±</h3>\n<h4>å•ä¸ªåŠ¨æ€æ®µ</h4>\n<pre><code class=\"language-tsx\">// app/blog/[slug]/page.tsx\nexport default function BlogPost({\n  params,\n}: {\n  params: { slug: string };\n}) {\n  return (\n    &#x3C;div>\n      &#x3C;h1>æ–‡ç« : {params.slug}&#x3C;/h1>\n    &#x3C;/div>\n  );\n}\n</code></pre>\n<h4>å¤šä¸ªåŠ¨æ€æ®µ</h4>\n<pre><code class=\"language-tsx\">// app/blog/[category]/[slug]/page.tsx\nexport default function CategoryPost({\n  params,\n}: {\n  params: { category: string; slug: string };\n}) {\n  return (\n    &#x3C;div>\n      &#x3C;h1>åˆ†ç±»: {params.category}&#x3C;/h1>\n      &#x3C;h2>æ–‡ç« : {params.slug}&#x3C;/h2>\n    &#x3C;/div>\n  );\n}\n</code></pre>\n<h4>æ•è·æ‰€æœ‰è·¯ç”±</h4>\n<pre><code class=\"language-tsx\">// app/docs/[...slug]/page.tsx\nexport default function DocsPage({\n  params,\n}: {\n  params: { slug: string[] };\n}) {\n  return (\n    &#x3C;div>\n      &#x3C;h1>æ–‡æ¡£è·¯å¾„: {params.slug.join('/')}&#x3C;/h1>\n    &#x3C;/div>\n  );\n}\n</code></pre>\n<h2>æœåŠ¡å™¨ç»„ä»¶ vs å®¢æˆ·ç«¯ç»„ä»¶</h2>\n<h3>æœåŠ¡å™¨ç»„ä»¶ (é»˜è®¤)</h3>\n<pre><code class=\"language-tsx\">// è¿™æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ç»„ä»¶\nasync function BlogPost({ params }: { params: { slug: string } }) {\n  // å¯ä»¥ç›´æ¥åœ¨æœåŠ¡å™¨ç«¯è·å–æ•°æ®\n  const post = await getPost(params.slug);\n\n  return (\n    &#x3C;article>\n      &#x3C;h1>{post.title}&#x3C;/h1>\n      &#x3C;p>{post.content}&#x3C;/p>\n    &#x3C;/article>\n  );\n}\n</code></pre>\n<h3>å®¢æˆ·ç«¯ç»„ä»¶</h3>\n<pre><code class=\"language-tsx\">'use client'; // æ ‡è®°ä¸ºå®¢æˆ·ç«¯ç»„ä»¶\n\nimport { useState } from 'react';\n\nexport default function Counter() {\n  const [count, setCount] = useState(0);\n\n  return (\n    &#x3C;div>\n      &#x3C;p>è®¡æ•°: {count}&#x3C;/p>\n      &#x3C;button onClick={() => setCount(count + 1)}>\n        å¢åŠ \n      &#x3C;/button>\n    &#x3C;/div>\n  );\n}\n</code></pre>\n<h2>æ•°æ®è·å–</h2>\n<h3>æœåŠ¡å™¨ç«¯æ•°æ®è·å–</h3>\n<pre><code class=\"language-tsx\">// app/posts/page.tsx\nasync function getPosts() {\n  const res = await fetch('https://api.example.com/posts', {\n    // å¯ä»¥é…ç½®ç¼“å­˜ç­–ç•¥\n    next: { revalidate: 3600 } // 1å°æ—¶åé‡æ–°éªŒè¯\n  });\n\n  if (!res.ok) {\n    throw new Error('Failed to fetch posts');\n  }\n\n  return res.json();\n}\n\nexport default async function PostsPage() {\n  const posts = await getPosts();\n\n  return (\n    &#x3C;div>\n      &#x3C;h1>æ–‡ç« åˆ—è¡¨&#x3C;/h1>\n      {posts.map((post: any) => (\n        &#x3C;div key={post.id}>\n          &#x3C;h2>{post.title}&#x3C;/h2>\n          &#x3C;p>{post.excerpt}&#x3C;/p>\n        &#x3C;/div>\n      ))}\n    &#x3C;/div>\n  );\n}\n</code></pre>\n<h3>å¹¶è¡Œæ•°æ®è·å–</h3>\n<pre><code class=\"language-tsx\">async function getUser(id: string) {\n  const res = await fetch(`/api/users/${id}`);\n  return res.json();\n}\n\nasync function getUserPosts(id: string) {\n  const res = await fetch(`/api/users/${id}/posts`);\n  return res.json();\n}\n\nexport default async function UserProfile({\n  params,\n}: {\n  params: { id: string };\n}) {\n  // å¹¶è¡Œè·å–æ•°æ®\n  const [user, posts] = await Promise.all([\n    getUser(params.id),\n    getUserPosts(params.id),\n  ]);\n\n  return (\n    &#x3C;div>\n      &#x3C;h1>{user.name}&#x3C;/h1>\n      &#x3C;div>\n        &#x3C;h2>ç”¨æˆ·æ–‡ç« &#x3C;/h2>\n        {posts.map((post: any) => (\n          &#x3C;div key={post.id}>{post.title}&#x3C;/div>\n        ))}\n      &#x3C;/div>\n    &#x3C;/div>\n  );\n}\n</code></pre>\n<h2>åŠ è½½çŠ¶æ€</h2>\n<pre><code class=\"language-tsx\">// app/blog/loading.tsx\nexport default function Loading() {\n  return (\n    &#x3C;div className=\"loading-container\">\n      &#x3C;div className=\"spinner\">&#x3C;/div>\n      &#x3C;p>åŠ è½½ä¸­...&#x3C;/p>\n    &#x3C;/div>\n  );\n}\n</code></pre>\n<h2>é”™è¯¯å¤„ç†</h2>\n<pre><code class=\"language-tsx\">// app/blog/error.tsx\n'use client';\n\nexport default function Error({\n  error,\n  reset,\n}: {\n  error: Error &#x26; { digest?: string };\n  reset: () => void;\n}) {\n  return (\n    &#x3C;div className=\"error-container\">\n      &#x3C;h2>å‡ºé”™äº†ï¼&#x3C;/h2>\n      &#x3C;p>{error.message}&#x3C;/p>\n      &#x3C;button onClick={reset}>é‡è¯•&#x3C;/button>\n    &#x3C;/div>\n  );\n}\n</code></pre>\n<h2>è·¯ç”±ç»„</h2>\n<p>ä½¿ç”¨æ‹¬å·åˆ›å»ºè·¯ç”±ç»„ï¼Œä¸å½±å“ URL ç»“æ„ï¼š</p>\n<pre><code>app/\nâ”œâ”€â”€ (marketing)/\nâ”‚   â”œâ”€â”€ about/\nâ”‚   â”‚   â””â”€â”€ page.tsx     // /about\nâ”‚   â””â”€â”€ contact/\nâ”‚       â””â”€â”€ page.tsx     // /contact\nâ””â”€â”€ (shop)/\n    â”œâ”€â”€ products/\n    â”‚   â””â”€â”€ page.tsx     // /products\n    â””â”€â”€ cart/\n        â””â”€â”€ page.tsx     // /cart\n</code></pre>\n<p>æ¯ä¸ªè·¯ç”±ç»„å¯ä»¥æœ‰è‡ªå·±çš„å¸ƒå±€ï¼š</p>\n<pre><code class=\"language-tsx\">// app/(marketing)/layout.tsx\nexport default function MarketingLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    &#x3C;div className=\"marketing-layout\">\n      &#x3C;nav>è¥é”€é¡µé¢å¯¼èˆª&#x3C;/nav>\n      {children}\n    &#x3C;/div>\n  );\n}\n</code></pre>\n<h2>æ‹¦æˆªè·¯ç”±</h2>\n<p>ä½¿ç”¨ <code>(..)</code> è¯­æ³•æ‹¦æˆªè·¯ç”±ï¼š</p>\n<pre><code>app/\nâ”œâ”€â”€ feed/\nâ”‚   â””â”€â”€ page.tsx\nâ”œâ”€â”€ photo/\nâ”‚   â””â”€â”€ [id]/\nâ”‚       â””â”€â”€ page.tsx\nâ””â”€â”€ @modal/\n    â””â”€â”€ (..)photo/\n        â””â”€â”€ [id]/\n            â””â”€â”€ page.tsx\n</code></pre>\n<h2>å¹¶è¡Œè·¯ç”±</h2>\n<p>ä½¿ç”¨ <code>@</code> è¯­æ³•åˆ›å»ºå¹¶è¡Œè·¯ç”±ï¼š</p>\n<pre><code class=\"language-tsx\">// app/layout.tsx\nexport default function Layout({\n  children,\n  analytics,\n  team,\n}: {\n  children: React.ReactNode;\n  analytics: React.ReactNode;\n  team: React.ReactNode;\n}) {\n  return (\n    &#x3C;>\n      {children}\n      {analytics}\n      {team}\n    &#x3C;/>\n  );\n}\n</code></pre>\n<h2>æœ€ä½³å®è·µ</h2>\n<h3>1. åˆç†ä½¿ç”¨æœåŠ¡å™¨ç»„ä»¶å’Œå®¢æˆ·ç«¯ç»„ä»¶</h3>\n<pre><code class=\"language-tsx\">// æœåŠ¡å™¨ç»„ä»¶è´Ÿè´£æ•°æ®è·å–\nasync function PostList() {\n  const posts = await getPosts();\n\n  return (\n    &#x3C;div>\n      {posts.map(post => (\n        &#x3C;PostCard key={post.id} post={post} />\n      ))}\n    &#x3C;/div>\n  );\n}\n\n// å®¢æˆ·ç«¯ç»„ä»¶è´Ÿè´£äº¤äº’\n'use client';\nfunction PostCard({ post }) {\n  const [liked, setLiked] = useState(false);\n\n  return (\n    &#x3C;div>\n      &#x3C;h3>{post.title}&#x3C;/h3>\n      &#x3C;button onClick={() => setLiked(!liked)}>\n        {liked ? 'â¤ï¸' : 'ğŸ¤'}\n      &#x3C;/button>\n    &#x3C;/div>\n  );\n}\n</code></pre>\n<h3>2. ä¼˜åŒ–æ•°æ®è·å–</h3>\n<pre><code class=\"language-tsx\">// ä½¿ç”¨é€‚å½“çš„ç¼“å­˜ç­–ç•¥\nasync function getData() {\n  const res = await fetch('https://api.example.com/data', {\n    next: {\n      revalidate: 3600, // é™æ€é‡æ–°ç”Ÿæˆ\n      tags: ['posts'] // æ ‡ç­¾é‡æ–°éªŒè¯\n    }\n  });\n\n  return res.json();\n}\n</code></pre>\n<h3>3. é”™è¯¯è¾¹ç•Œå’ŒåŠ è½½çŠ¶æ€</h3>\n<p>ä¸ºæ¯ä¸ªè·¯ç”±æ®µæä¾›é€‚å½“çš„é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€ï¼š</p>\n<pre><code>app/\nâ”œâ”€â”€ dashboard/\nâ”‚   â”œâ”€â”€ loading.tsx      // ä»ªè¡¨æ¿åŠ è½½çŠ¶æ€\nâ”‚   â”œâ”€â”€ error.tsx        // ä»ªè¡¨æ¿é”™è¯¯å¤„ç†\nâ”‚   â”œâ”€â”€ page.tsx\nâ”‚   â””â”€â”€ analytics/\nâ”‚       â”œâ”€â”€ loading.tsx  // åˆ†æé¡µé¢åŠ è½½çŠ¶æ€\nâ”‚       â”œâ”€â”€ error.tsx    // åˆ†æé¡µé¢é”™è¯¯å¤„ç†\nâ”‚       â””â”€â”€ page.tsx\n</code></pre>\n<h2>æ€»ç»“</h2>\n<p>Next.js App Router å¸¦æ¥äº†è®¸å¤šå¼ºå¤§çš„ç‰¹æ€§ï¼š</p>\n<ul>\n<li><strong>åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„è·¯ç”±</strong>: ç›´è§‚çš„è·¯ç”±ç»“æ„</li>\n<li><strong>å¸ƒå±€ç³»ç»Ÿ</strong>: çµæ´»çš„åµŒå¥—å¸ƒå±€</li>\n<li><strong>æœåŠ¡å™¨ç»„ä»¶</strong>: æ›´å¥½çš„æ€§èƒ½å’Œ SEO</li>\n<li><strong>æµå¼æ¸²æŸ“</strong>: æ”¹å–„ç”¨æˆ·ä½“éªŒ</li>\n<li><strong>å¹¶è¡Œè·¯ç”±</strong>: å¤æ‚ UI çš„è§£å†³æ–¹æ¡ˆ</li>\n</ul>\n<p>App Router ä»£è¡¨äº† React å’Œ Next.js çš„æœªæ¥æ–¹å‘ï¼Œå€¼å¾—æˆ‘ä»¬æ·±å…¥å­¦ä¹ å’Œå®è·µã€‚</p>"
    },
    "_id": "articles/nextjs-app-router-guide.md",
    "_raw": {
      "sourceFilePath": "articles/nextjs-app-router-guide.md",
      "sourceFileName": "nextjs-app-router-guide.md",
      "sourceFileDir": "articles",
      "contentType": "markdown",
      "flattenedPath": "articles/nextjs-app-router-guide"
    },
    "type": "Article",
    "slug": "nextjs-app-router-guide",
    "readingTime": {
      "text": "7 min read",
      "minutes": 6.71,
      "time": 402600,
      "words": 1342
    },
    "url": "/articles/nextjs-app-router-guide"
  },
  {
    "title": "React 18 å¹¶å‘ç‰¹æ€§æ·±åº¦è§£æ",
    "excerpt": "æ·±å…¥æ¢è®¨ React 18 çš„å¹¶å‘æ¸²æŸ“æœºåˆ¶ï¼ŒåŒ…æ‹¬ useTransitionã€useDeferredValue ç­‰æ–° Hook çš„ä½¿ç”¨åœºæ™¯å’Œæœ€ä½³å®è·µã€‚",
    "publishedAt": "2024-01-15T00:00:00.000Z",
    "updatedAt": "2024-01-20T00:00:00.000Z",
    "author": "li-lingfeng",
    "category": "frontend",
    "tags": [
      "react",
      "typescript"
    ],
    "featured": true,
    "published": true,
    "image": "/images/articles/react-18-concurrent.jpg",
    "seoTitle": "React 18 å¹¶å‘ç‰¹æ€§æ·±åº¦è§£æ - æå‡åº”ç”¨æ€§èƒ½çš„æ–°æ–¹æ³•",
    "seoDescription": "å­¦ä¹  React 18 çš„å¹¶å‘ç‰¹æ€§ï¼ŒæŒæ¡ useTransitionã€useDeferredValue ç­‰æ–° Hookï¼Œæå‡åº”ç”¨æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ",
    "seoKeywords": [
      "React 18",
      "å¹¶å‘æ¸²æŸ“",
      "useTransition",
      "useDeferredValue",
      "æ€§èƒ½ä¼˜åŒ–"
    ],
    "body": {
      "raw": "\n# React 18 å¹¶å‘ç‰¹æ€§æ·±åº¦è§£æ\n\nReact 18 å¼•å…¥äº†æœŸå¾…å·²ä¹…çš„å¹¶å‘ç‰¹æ€§ï¼Œè¿™äº›ç‰¹æ€§è®©æˆ‘ä»¬èƒ½å¤Ÿæ„å»ºæ›´åŠ æµç•…å’Œå“åº”å¼çš„ç”¨æˆ·ç•Œé¢ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨è¿™äº›æ–°ç‰¹æ€§çš„å·¥ä½œåŸç†å’Œå®é™…åº”ç”¨ã€‚\n\n## ä»€ä¹ˆæ˜¯å¹¶å‘æ¸²æŸ“ï¼Ÿ\n\nå¹¶å‘æ¸²æŸ“æ˜¯ React 18 çš„æ ¸å¿ƒç‰¹æ€§ï¼Œå®ƒå…è®¸ React åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­æš‚åœå’Œæ¢å¤å·¥ä½œã€‚è¿™æ„å‘³ç€ï¼š\n\n- React å¯ä»¥åŒæ—¶å‡†å¤‡å¤šä¸ªç‰ˆæœ¬çš„ UI\n- é«˜ä¼˜å…ˆçº§çš„æ›´æ–°å¯ä»¥ä¸­æ–­ä½ä¼˜å…ˆçº§çš„æ›´æ–°\n- ç”¨æˆ·ç•Œé¢ä¿æŒå“åº”ï¼Œå³ä½¿åœ¨å¤„ç†å¤§é‡è®¡ç®—æ—¶\n\n## useTransition Hook\n\n`useTransition` æ˜¯ React 18 ä¸­æœ€é‡è¦çš„æ–° Hook ä¹‹ä¸€ï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†çŠ¶æ€æ›´æ–°æ ‡è®°ä¸ºéç´§æ€¥çš„ã€‚\n\n### åŸºæœ¬ç”¨æ³•\n\n```jsx\nimport { useState, useTransition } from 'react';\n\nfunction SearchResults() {\n  const [query, setQuery] = useState('');\n  const [results, setResults] = useState([]);\n  const [isPending, startTransition] = useTransition();\n\n  const handleSearch = (newQuery) => {\n    setQuery(newQuery); // ç´§æ€¥æ›´æ–°\n\n    startTransition(() => {\n      // éç´§æ€¥æ›´æ–°\n      setResults(searchData(newQuery));\n    });\n  };\n\n  return (\n    <div>\n      <input\n        value={query}\n        onChange={(e) => handleSearch(e.target.value)}\n        placeholder=\"æœç´¢...\"\n      />\n\n      {isPending && <div>æœç´¢ä¸­...</div>}\n\n      <SearchResultsList results={results} />\n    </div>\n  );\n}\n```\n\n### å®é™…åº”ç”¨åœºæ™¯\n\n1. **æœç´¢åŠŸèƒ½**: è¾“å…¥æ¡†çš„æ›´æ–°æ˜¯ç´§æ€¥çš„ï¼Œæœç´¢ç»“æœçš„æ›´æ–°å¯ä»¥å»¶è¿Ÿ\n2. **æ ‡ç­¾é¡µåˆ‡æ¢**: æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€æ˜¯ç´§æ€¥çš„ï¼Œå†…å®¹åŠ è½½å¯ä»¥å»¶è¿Ÿ\n3. **æ•°æ®è¿‡æ»¤**: è¿‡æ»¤æ¡ä»¶çš„æ›´æ–°æ˜¯ç´§æ€¥çš„ï¼Œç»“æœæ¸²æŸ“å¯ä»¥å»¶è¿Ÿ\n\n## useDeferredValue Hook\n\n`useDeferredValue` å…è®¸æˆ‘ä»¬å»¶è¿Ÿæ›´æ–° UI çš„æŸäº›éƒ¨åˆ†ï¼Œç›´åˆ°æ›´ç´§æ€¥çš„æ›´æ–°å®Œæˆã€‚\n\n### åŸºæœ¬ç”¨æ³•\n\n```jsx\nimport { useState, useDeferredValue, useMemo } from 'react';\n\nfunction ProductList({ searchQuery }) {\n  const deferredQuery = useDeferredValue(searchQuery);\n\n  const filteredProducts = useMemo(() => {\n    return products.filter(product =>\n      product.name.toLowerCase().includes(deferredQuery.toLowerCase())\n    );\n  }, [deferredQuery]);\n\n  return (\n    <div>\n      {filteredProducts.map(product => (\n        <ProductCard key={product.id} product={product} />\n      ))}\n    </div>\n  );\n}\n```\n\n### ä¸ useTransition çš„åŒºåˆ«\n\n- `useTransition`: æ§åˆ¶çŠ¶æ€æ›´æ–°çš„ä¼˜å…ˆçº§\n- `useDeferredValue`: å»¶è¿Ÿå€¼çš„æ›´æ–°ï¼Œé€šå¸¸ç”¨äºæ˜‚è´µçš„è®¡ç®—\n\n## Suspense çš„æ”¹è¿›\n\nReact 18 ä¸­çš„ Suspense ä¸ä»…æ”¯æŒä»£ç åˆ†å‰²ï¼Œè¿˜æ”¯æŒæ•°æ®è·å–ï¼š\n\n```jsx\nfunction App() {\n  return (\n    <Suspense fallback={<GlobalSpinner />}>\n      <Header />\n      <Suspense fallback={<SidebarSkeleton />}>\n        <Sidebar />\n      </Suspense>\n      <Suspense fallback={<ContentSkeleton />}>\n        <MainContent />\n      </Suspense>\n    </Suspense>\n  );\n}\n```\n\n## è‡ªåŠ¨æ‰¹å¤„ç†\n\nReact 18 è‡ªåŠ¨æ‰¹å¤„ç†æ‰€æœ‰çŠ¶æ€æ›´æ–°ï¼ŒåŒ…æ‹¬åœ¨ Promiseã€setTimeout å’ŒåŸç”Ÿäº‹ä»¶å¤„ç†å™¨ä¸­çš„æ›´æ–°ï¼š\n\n```jsx\n// React 18 ä¸­ï¼Œè¿™äº›æ›´æ–°ä¼šè¢«è‡ªåŠ¨æ‰¹å¤„ç†\nfunction handleClick() {\n  setCount(c => c + 1);\n  setFlag(f => !f);\n  // React åªä¼šé‡æ–°æ¸²æŸ“ä¸€æ¬¡\n}\n\n// å¦‚æœéœ€è¦é€€å‡ºæ‰¹å¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨ flushSync\nimport { flushSync } from 'react-dom';\n\nfunction handleClick() {\n  flushSync(() => {\n    setCount(c => c + 1);\n  });\n  // React å·²ç»é‡æ–°æ¸²æŸ“äº†\n  flushSync(() => {\n    setFlag(f => !f);\n  });\n  // React å†æ¬¡é‡æ–°æ¸²æŸ“äº†\n}\n```\n\n## æœ€ä½³å®è·µ\n\n### 1. è¯†åˆ«ç´§æ€¥å’Œéç´§æ€¥æ›´æ–°\n\n```jsx\n// ç´§æ€¥ï¼šç”¨æˆ·è¾“å…¥ã€æ‚¬åœã€ç‚¹å‡»\nconst handleInputChange = (value) => {\n  setValue(value); // ç´§æ€¥æ›´æ–°\n\n  startTransition(() => {\n    setSearchResults(search(value)); // éç´§æ€¥æ›´æ–°\n  });\n};\n```\n\n### 2. ä½¿ç”¨ useMemo ä¼˜åŒ–æ˜‚è´µè®¡ç®—\n\n```jsx\nconst ExpensiveComponent = ({ data }) => {\n  const deferredData = useDeferredValue(data);\n\n  const expensiveValue = useMemo(() => {\n    return performExpensiveCalculation(deferredData);\n  }, [deferredData]);\n\n  return <div>{expensiveValue}</div>;\n};\n```\n\n### 3. åˆç†ä½¿ç”¨ Suspense è¾¹ç•Œ\n\n```jsx\n// ä¸ºä¸åŒçš„ UI éƒ¨åˆ†è®¾ç½®ä¸åŒçš„ Suspense è¾¹ç•Œ\nfunction Dashboard() {\n  return (\n    <div>\n      <Suspense fallback={<HeaderSkeleton />}>\n        <Header />\n      </Suspense>\n\n      <div className=\"main-content\">\n        <Suspense fallback={<SidebarSkeleton />}>\n          <Sidebar />\n        </Suspense>\n\n        <Suspense fallback={<ContentSkeleton />}>\n          <MainContent />\n        </Suspense>\n      </div>\n    </div>\n  );\n}\n```\n\n## æ€§èƒ½ç›‘æ§\n\nä½¿ç”¨ React DevTools Profiler æ¥ç›‘æ§å¹¶å‘ç‰¹æ€§çš„æ•ˆæœï¼š\n\n```jsx\nimport { Profiler } from 'react';\n\nfunction onRenderCallback(id, phase, actualDuration) {\n  console.log('Component:', id);\n  console.log('Phase:', phase);\n  console.log('Duration:', actualDuration);\n}\n\nfunction App() {\n  return (\n    <Profiler id=\"App\" onRender={onRenderCallback}>\n      <MyComponent />\n    </Profiler>\n  );\n}\n```\n\n## æ€»ç»“\n\nReact 18 çš„å¹¶å‘ç‰¹æ€§ä¸ºæˆ‘ä»¬æä¾›äº†å¼ºå¤§çš„å·¥å…·æ¥æ„å»ºæ›´åŠ æµç•…çš„ç”¨æˆ·ç•Œé¢ï¼š\n\n- **useTransition**: æ ‡è®°éç´§æ€¥æ›´æ–°ï¼Œä¿æŒç•Œé¢å“åº”\n- **useDeferredValue**: å»¶è¿Ÿæ˜‚è´µè®¡ç®—ï¼Œä¼˜åŒ–æ€§èƒ½\n- **æ”¹è¿›çš„ Suspense**: æ›´å¥½çš„åŠ è½½çŠ¶æ€ç®¡ç†\n- **è‡ªåŠ¨æ‰¹å¤„ç†**: å‡å°‘ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“\n\nè¿™äº›ç‰¹æ€§éœ€è¦æˆ‘ä»¬é‡æ–°æ€è€ƒåº”ç”¨çš„çŠ¶æ€ç®¡ç†å’Œæ›´æ–°ç­–ç•¥ã€‚é€šè¿‡åˆç†ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾è‘—æå‡åº”ç”¨çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚\n\nè®°ä½ï¼Œå¹¶å‘ç‰¹æ€§æ˜¯æ¸è¿›å¼çš„å¢å¼ºï¼Œä½ å¯ä»¥é€æ­¥åœ¨ç°æœ‰åº”ç”¨ä¸­é‡‡ç”¨è¿™äº›ç‰¹æ€§ï¼Œè€Œä¸éœ€è¦å¤§è§„æ¨¡é‡æ„ã€‚\n",
      "html": "<h1>React 18 å¹¶å‘ç‰¹æ€§æ·±åº¦è§£æ</h1>\n<p>React 18 å¼•å…¥äº†æœŸå¾…å·²ä¹…çš„å¹¶å‘ç‰¹æ€§ï¼Œè¿™äº›ç‰¹æ€§è®©æˆ‘ä»¬èƒ½å¤Ÿæ„å»ºæ›´åŠ æµç•…å’Œå“åº”å¼çš„ç”¨æˆ·ç•Œé¢ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨è¿™äº›æ–°ç‰¹æ€§çš„å·¥ä½œåŸç†å’Œå®é™…åº”ç”¨ã€‚</p>\n<h2>ä»€ä¹ˆæ˜¯å¹¶å‘æ¸²æŸ“ï¼Ÿ</h2>\n<p>å¹¶å‘æ¸²æŸ“æ˜¯ React 18 çš„æ ¸å¿ƒç‰¹æ€§ï¼Œå®ƒå…è®¸ React åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­æš‚åœå’Œæ¢å¤å·¥ä½œã€‚è¿™æ„å‘³ç€ï¼š</p>\n<ul>\n<li>React å¯ä»¥åŒæ—¶å‡†å¤‡å¤šä¸ªç‰ˆæœ¬çš„ UI</li>\n<li>é«˜ä¼˜å…ˆçº§çš„æ›´æ–°å¯ä»¥ä¸­æ–­ä½ä¼˜å…ˆçº§çš„æ›´æ–°</li>\n<li>ç”¨æˆ·ç•Œé¢ä¿æŒå“åº”ï¼Œå³ä½¿åœ¨å¤„ç†å¤§é‡è®¡ç®—æ—¶</li>\n</ul>\n<h2>useTransition Hook</h2>\n<p><code>useTransition</code> æ˜¯ React 18 ä¸­æœ€é‡è¦çš„æ–° Hook ä¹‹ä¸€ï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†çŠ¶æ€æ›´æ–°æ ‡è®°ä¸ºéç´§æ€¥çš„ã€‚</p>\n<h3>åŸºæœ¬ç”¨æ³•</h3>\n<pre><code class=\"language-jsx\">import { useState, useTransition } from 'react';\n\nfunction SearchResults() {\n  const [query, setQuery] = useState('');\n  const [results, setResults] = useState([]);\n  const [isPending, startTransition] = useTransition();\n\n  const handleSearch = (newQuery) => {\n    setQuery(newQuery); // ç´§æ€¥æ›´æ–°\n\n    startTransition(() => {\n      // éç´§æ€¥æ›´æ–°\n      setResults(searchData(newQuery));\n    });\n  };\n\n  return (\n    &#x3C;div>\n      &#x3C;input\n        value={query}\n        onChange={(e) => handleSearch(e.target.value)}\n        placeholder=\"æœç´¢...\"\n      />\n\n      {isPending &#x26;&#x26; &#x3C;div>æœç´¢ä¸­...&#x3C;/div>}\n\n      &#x3C;SearchResultsList results={results} />\n    &#x3C;/div>\n  );\n}\n</code></pre>\n<h3>å®é™…åº”ç”¨åœºæ™¯</h3>\n<ol>\n<li><strong>æœç´¢åŠŸèƒ½</strong>: è¾“å…¥æ¡†çš„æ›´æ–°æ˜¯ç´§æ€¥çš„ï¼Œæœç´¢ç»“æœçš„æ›´æ–°å¯ä»¥å»¶è¿Ÿ</li>\n<li><strong>æ ‡ç­¾é¡µåˆ‡æ¢</strong>: æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€æ˜¯ç´§æ€¥çš„ï¼Œå†…å®¹åŠ è½½å¯ä»¥å»¶è¿Ÿ</li>\n<li><strong>æ•°æ®è¿‡æ»¤</strong>: è¿‡æ»¤æ¡ä»¶çš„æ›´æ–°æ˜¯ç´§æ€¥çš„ï¼Œç»“æœæ¸²æŸ“å¯ä»¥å»¶è¿Ÿ</li>\n</ol>\n<h2>useDeferredValue Hook</h2>\n<p><code>useDeferredValue</code> å…è®¸æˆ‘ä»¬å»¶è¿Ÿæ›´æ–° UI çš„æŸäº›éƒ¨åˆ†ï¼Œç›´åˆ°æ›´ç´§æ€¥çš„æ›´æ–°å®Œæˆã€‚</p>\n<h3>åŸºæœ¬ç”¨æ³•</h3>\n<pre><code class=\"language-jsx\">import { useState, useDeferredValue, useMemo } from 'react';\n\nfunction ProductList({ searchQuery }) {\n  const deferredQuery = useDeferredValue(searchQuery);\n\n  const filteredProducts = useMemo(() => {\n    return products.filter(product =>\n      product.name.toLowerCase().includes(deferredQuery.toLowerCase())\n    );\n  }, [deferredQuery]);\n\n  return (\n    &#x3C;div>\n      {filteredProducts.map(product => (\n        &#x3C;ProductCard key={product.id} product={product} />\n      ))}\n    &#x3C;/div>\n  );\n}\n</code></pre>\n<h3>ä¸ useTransition çš„åŒºåˆ«</h3>\n<ul>\n<li><code>useTransition</code>: æ§åˆ¶çŠ¶æ€æ›´æ–°çš„ä¼˜å…ˆçº§</li>\n<li><code>useDeferredValue</code>: å»¶è¿Ÿå€¼çš„æ›´æ–°ï¼Œé€šå¸¸ç”¨äºæ˜‚è´µçš„è®¡ç®—</li>\n</ul>\n<h2>Suspense çš„æ”¹è¿›</h2>\n<p>React 18 ä¸­çš„ Suspense ä¸ä»…æ”¯æŒä»£ç åˆ†å‰²ï¼Œè¿˜æ”¯æŒæ•°æ®è·å–ï¼š</p>\n<pre><code class=\"language-jsx\">function App() {\n  return (\n    &#x3C;Suspense fallback={&#x3C;GlobalSpinner />}>\n      &#x3C;Header />\n      &#x3C;Suspense fallback={&#x3C;SidebarSkeleton />}>\n        &#x3C;Sidebar />\n      &#x3C;/Suspense>\n      &#x3C;Suspense fallback={&#x3C;ContentSkeleton />}>\n        &#x3C;MainContent />\n      &#x3C;/Suspense>\n    &#x3C;/Suspense>\n  );\n}\n</code></pre>\n<h2>è‡ªåŠ¨æ‰¹å¤„ç†</h2>\n<p>React 18 è‡ªåŠ¨æ‰¹å¤„ç†æ‰€æœ‰çŠ¶æ€æ›´æ–°ï¼ŒåŒ…æ‹¬åœ¨ Promiseã€setTimeout å’ŒåŸç”Ÿäº‹ä»¶å¤„ç†å™¨ä¸­çš„æ›´æ–°ï¼š</p>\n<pre><code class=\"language-jsx\">// React 18 ä¸­ï¼Œè¿™äº›æ›´æ–°ä¼šè¢«è‡ªåŠ¨æ‰¹å¤„ç†\nfunction handleClick() {\n  setCount(c => c + 1);\n  setFlag(f => !f);\n  // React åªä¼šé‡æ–°æ¸²æŸ“ä¸€æ¬¡\n}\n\n// å¦‚æœéœ€è¦é€€å‡ºæ‰¹å¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨ flushSync\nimport { flushSync } from 'react-dom';\n\nfunction handleClick() {\n  flushSync(() => {\n    setCount(c => c + 1);\n  });\n  // React å·²ç»é‡æ–°æ¸²æŸ“äº†\n  flushSync(() => {\n    setFlag(f => !f);\n  });\n  // React å†æ¬¡é‡æ–°æ¸²æŸ“äº†\n}\n</code></pre>\n<h2>æœ€ä½³å®è·µ</h2>\n<h3>1. è¯†åˆ«ç´§æ€¥å’Œéç´§æ€¥æ›´æ–°</h3>\n<pre><code class=\"language-jsx\">// ç´§æ€¥ï¼šç”¨æˆ·è¾“å…¥ã€æ‚¬åœã€ç‚¹å‡»\nconst handleInputChange = (value) => {\n  setValue(value); // ç´§æ€¥æ›´æ–°\n\n  startTransition(() => {\n    setSearchResults(search(value)); // éç´§æ€¥æ›´æ–°\n  });\n};\n</code></pre>\n<h3>2. ä½¿ç”¨ useMemo ä¼˜åŒ–æ˜‚è´µè®¡ç®—</h3>\n<pre><code class=\"language-jsx\">const ExpensiveComponent = ({ data }) => {\n  const deferredData = useDeferredValue(data);\n\n  const expensiveValue = useMemo(() => {\n    return performExpensiveCalculation(deferredData);\n  }, [deferredData]);\n\n  return &#x3C;div>{expensiveValue}&#x3C;/div>;\n};\n</code></pre>\n<h3>3. åˆç†ä½¿ç”¨ Suspense è¾¹ç•Œ</h3>\n<pre><code class=\"language-jsx\">// ä¸ºä¸åŒçš„ UI éƒ¨åˆ†è®¾ç½®ä¸åŒçš„ Suspense è¾¹ç•Œ\nfunction Dashboard() {\n  return (\n    &#x3C;div>\n      &#x3C;Suspense fallback={&#x3C;HeaderSkeleton />}>\n        &#x3C;Header />\n      &#x3C;/Suspense>\n\n      &#x3C;div className=\"main-content\">\n        &#x3C;Suspense fallback={&#x3C;SidebarSkeleton />}>\n          &#x3C;Sidebar />\n        &#x3C;/Suspense>\n\n        &#x3C;Suspense fallback={&#x3C;ContentSkeleton />}>\n          &#x3C;MainContent />\n        &#x3C;/Suspense>\n      &#x3C;/div>\n    &#x3C;/div>\n  );\n}\n</code></pre>\n<h2>æ€§èƒ½ç›‘æ§</h2>\n<p>ä½¿ç”¨ React DevTools Profiler æ¥ç›‘æ§å¹¶å‘ç‰¹æ€§çš„æ•ˆæœï¼š</p>\n<pre><code class=\"language-jsx\">import { Profiler } from 'react';\n\nfunction onRenderCallback(id, phase, actualDuration) {\n  console.log('Component:', id);\n  console.log('Phase:', phase);\n  console.log('Duration:', actualDuration);\n}\n\nfunction App() {\n  return (\n    &#x3C;Profiler id=\"App\" onRender={onRenderCallback}>\n      &#x3C;MyComponent />\n    &#x3C;/Profiler>\n  );\n}\n</code></pre>\n<h2>æ€»ç»“</h2>\n<p>React 18 çš„å¹¶å‘ç‰¹æ€§ä¸ºæˆ‘ä»¬æä¾›äº†å¼ºå¤§çš„å·¥å…·æ¥æ„å»ºæ›´åŠ æµç•…çš„ç”¨æˆ·ç•Œé¢ï¼š</p>\n<ul>\n<li><strong>useTransition</strong>: æ ‡è®°éç´§æ€¥æ›´æ–°ï¼Œä¿æŒç•Œé¢å“åº”</li>\n<li><strong>useDeferredValue</strong>: å»¶è¿Ÿæ˜‚è´µè®¡ç®—ï¼Œä¼˜åŒ–æ€§èƒ½</li>\n<li><strong>æ”¹è¿›çš„ Suspense</strong>: æ›´å¥½çš„åŠ è½½çŠ¶æ€ç®¡ç†</li>\n<li><strong>è‡ªåŠ¨æ‰¹å¤„ç†</strong>: å‡å°‘ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“</li>\n</ul>\n<p>è¿™äº›ç‰¹æ€§éœ€è¦æˆ‘ä»¬é‡æ–°æ€è€ƒåº”ç”¨çš„çŠ¶æ€ç®¡ç†å’Œæ›´æ–°ç­–ç•¥ã€‚é€šè¿‡åˆç†ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾è‘—æå‡åº”ç”¨çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚</p>\n<p>è®°ä½ï¼Œå¹¶å‘ç‰¹æ€§æ˜¯æ¸è¿›å¼çš„å¢å¼ºï¼Œä½ å¯ä»¥é€æ­¥åœ¨ç°æœ‰åº”ç”¨ä¸­é‡‡ç”¨è¿™äº›ç‰¹æ€§ï¼Œè€Œä¸éœ€è¦å¤§è§„æ¨¡é‡æ„ã€‚</p>"
    },
    "_id": "articles/react-18-concurrent-features.md",
    "_raw": {
      "sourceFilePath": "articles/react-18-concurrent-features.md",
      "sourceFileName": "react-18-concurrent-features.md",
      "sourceFileDir": "articles",
      "contentType": "markdown",
      "flattenedPath": "articles/react-18-concurrent-features"
    },
    "type": "Article",
    "slug": "react-18-concurrent-features",
    "readingTime": {
      "text": "6 min read",
      "minutes": 5.1,
      "time": 306000,
      "words": 1020
    },
    "url": "/articles/react-18-concurrent-features"
  },
  {
    "title": "TypeScript é«˜çº§ç±»å‹å®æˆ˜æŒ‡å—",
    "excerpt": "æ·±å…¥æ¢ç´¢ TypeScript çš„é«˜çº§ç±»å‹ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ¡ä»¶ç±»å‹ã€æ˜ å°„ç±»å‹ã€æ¨¡æ¿å­—é¢é‡ç±»å‹ç­‰ï¼Œé€šè¿‡å®é™…æ¡ˆä¾‹å­¦ä¹ å¦‚ä½•æ„å»ºç±»å‹å®‰å…¨çš„åº”ç”¨ã€‚",
    "publishedAt": "2024-01-28T00:00:00.000Z",
    "author": "li-lingfeng",
    "category": "frontend",
    "tags": [
      "typescript",
      "javascript"
    ],
    "featured": false,
    "published": true,
    "image": "/images/articles/typescript-advanced.jpg",
    "seoTitle": "TypeScript é«˜çº§ç±»å‹å®æˆ˜æŒ‡å— - æŒæ¡ç±»å‹ç¼–ç¨‹",
    "seoDescription": "å­¦ä¹  TypeScript é«˜çº§ç±»å‹ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ¡ä»¶ç±»å‹ã€æ˜ å°„ç±»å‹ã€æ¨¡æ¿å­—é¢é‡ç±»å‹ç­‰ï¼Œæå‡ä»£ç è´¨é‡å’Œå¼€å‘æ•ˆç‡",
    "seoKeywords": [
      "TypeScript",
      "é«˜çº§ç±»å‹",
      "æ¡ä»¶ç±»å‹",
      "æ˜ å°„ç±»å‹",
      "ç±»å‹ç¼–ç¨‹"
    ],
    "body": {
      "raw": "\n# TypeScript é«˜çº§ç±»å‹å®æˆ˜æŒ‡å—\n\nTypeScript çš„ç±»å‹ç³»ç»Ÿéå¸¸å¼ºå¤§ï¼ŒæŒæ¡é«˜çº§ç±»å‹æŠ€å·§å¯ä»¥è®©æˆ‘ä»¬å†™å‡ºæ›´å®‰å…¨ã€æ›´ä¼˜é›…çš„ä»£ç ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ TypeScript çš„é«˜çº§ç±»å‹ç‰¹æ€§ã€‚\n\n## æ¡ä»¶ç±»å‹ (Conditional Types)\n\næ¡ä»¶ç±»å‹å…è®¸æˆ‘ä»¬æ ¹æ®æ¡ä»¶é€‰æ‹©ç±»å‹ï¼Œè¯­æ³•ç±»ä¼¼äºä¸‰å…ƒè¿ç®—ç¬¦ã€‚\n\n### åŸºç¡€è¯­æ³•\n\n```typescript\ntype ConditionalType<T> = T extends string ? string : number;\n\ntype Test1 = ConditionalType<string>; // string\ntype Test2 = ConditionalType<number>; // number\n```\n\n### å®é™…åº”ç”¨ï¼šç±»å‹å®ˆå«\n\n```typescript\ntype NonNullable<T> = T extends null | undefined ? never : T;\n\ntype Example1 = NonNullable<string | null>; // string\ntype Example2 = NonNullable<number | undefined>; // number\n```\n\n### åˆ†å¸ƒå¼æ¡ä»¶ç±»å‹\n\nå½“æ¡ä»¶ç±»å‹ä½œç”¨äºè”åˆç±»å‹æ—¶ï¼Œä¼šåˆ†å¸ƒåˆ°æ¯ä¸ªæˆå‘˜ï¼š\n\n```typescript\ntype ToArray<T> = T extends any ? T[] : never;\n\ntype StrArrOrNumArr = ToArray<string | number>; // string[] | number[]\n```\n\n## æ˜ å°„ç±»å‹ (Mapped Types)\n\næ˜ å°„ç±»å‹å¯ä»¥åŸºäºç°æœ‰ç±»å‹åˆ›å»ºæ–°ç±»å‹ã€‚\n\n### å†…ç½®æ˜ å°„ç±»å‹\n\n```typescript\n// Partial - æ‰€æœ‰å±æ€§å˜ä¸ºå¯é€‰\ntype Partial<T> = {\n  [P in keyof T]?: T[P];\n};\n\n// Required - æ‰€æœ‰å±æ€§å˜ä¸ºå¿…éœ€\ntype Required<T> = {\n  [P in keyof T]-?: T[P];\n};\n\n// Readonly - æ‰€æœ‰å±æ€§å˜ä¸ºåªè¯»\ntype Readonly<T> = {\n  readonly [P in keyof T]: T[P];\n};\n```\n\n### è‡ªå®šä¹‰æ˜ å°„ç±»å‹\n\n```typescript\n// ä¸ºæ‰€æœ‰å±æ€§æ·»åŠ å‰ç¼€\ntype Prefixed<T, P extends string> = {\n  [K in keyof T as `${P}${string & K}`]: T[K];\n};\n\ninterface User {\n  name: string;\n  age: number;\n}\n\ntype PrefixedUser = Prefixed<User, 'user_'>;\n// { user_name: string; user_age: number; }\n```\n\n## æ¨¡æ¿å­—é¢é‡ç±»å‹ (Template Literal Types)\n\nTypeScript 4.1 å¼•å…¥äº†æ¨¡æ¿å­—é¢é‡ç±»å‹ï¼Œå…è®¸æˆ‘ä»¬åœ¨ç±»å‹å±‚é¢æ“ä½œå­—ç¬¦ä¸²ã€‚\n\n### åŸºç¡€ç”¨æ³•\n\n```typescript\ntype World = \"world\";\ntype Greeting = `hello ${World}`; // \"hello world\"\n```\n\n### å®é™…åº”ç”¨ï¼šäº‹ä»¶ç³»ç»Ÿ\n\n```typescript\ntype EventName<T extends string> = `on${Capitalize<T>}`;\n\ntype ButtonEvents = EventName<'click' | 'hover' | 'focus'>;\n// 'onClick' | 'onHover' | 'onFocus'\n\n// äº‹ä»¶å¤„ç†å™¨ç±»å‹\ntype EventHandlers<T extends Record<string, any>> = {\n  [K in keyof T as EventName<string & K>]?: (event: T[K]) => void;\n};\n\ninterface Events {\n  click: MouseEvent;\n  hover: MouseEvent;\n  focus: FocusEvent;\n}\n\ntype Handlers = EventHandlers<Events>;\n// {\n//   onClick?: (event: MouseEvent) => void;\n//   onHover?: (event: MouseEvent) => void;\n//   onFocus?: (event: FocusEvent) => void;\n// }\n```\n\n## å·¥å…·ç±»å‹ç»„åˆ\n\n### æ·±åº¦åªè¯»ç±»å‹\n\n```typescript\ntype DeepReadonly<T> = {\n  readonly [P in keyof T]: T[P] extends object ? DeepReadonly<T[P]> : T[P];\n};\n\ninterface NestedObject {\n  user: {\n    profile: {\n      name: string;\n      settings: {\n        theme: string;\n      };\n    };\n  };\n}\n\ntype ReadonlyNested = DeepReadonly<NestedObject>;\n// æ‰€æœ‰åµŒå¥—å±æ€§éƒ½å˜ä¸ºåªè¯»\n```\n\n### ç±»å‹å®‰å…¨çš„è·¯å¾„è®¿é—®\n\n```typescript\ntype PathKeys<T> = {\n  [K in keyof T]: T[K] extends object\n    ? K | `${string & K}.${PathKeys<T[K]>}`\n    : K;\n}[keyof T];\n\ntype GetByPath<T, P extends string> = P extends `${infer K}.${infer Rest}`\n  ? K extends keyof T\n    ? GetByPath<T[K], Rest>\n    : never\n  : P extends keyof T\n  ? T[P]\n  : never;\n\ninterface Data {\n  user: {\n    profile: {\n      name: string;\n      age: number;\n    };\n    settings: {\n      theme: 'light' | 'dark';\n    };\n  };\n}\n\ntype ValidPaths = PathKeys<Data>;\n// 'user' | 'user.profile' | 'user.profile.name' | 'user.profile.age' | 'user.settings' | 'user.settings.theme'\n\nfunction getValue<T, P extends PathKeys<T>>(obj: T, path: P): GetByPath<T, P> {\n  // å®ç°çœç•¥\n  return null as any;\n}\n\nconst data: Data = { /* ... */ };\nconst name = getValue(data, 'user.profile.name'); // string\nconst theme = getValue(data, 'user.settings.theme'); // 'light' | 'dark'\n```\n\n## å®é™…åº”ç”¨æ¡ˆä¾‹\n\n### ç±»å‹å®‰å…¨çš„ API å®¢æˆ·ç«¯\n\n```typescript\n// API ç«¯ç‚¹å®šä¹‰\ninterface ApiEndpoints {\n  '/users': {\n    GET: { response: User[] };\n    POST: { body: CreateUserRequest; response: User };\n  };\n  '/users/:id': {\n    GET: { params: { id: string }; response: User };\n    PUT: { params: { id: string }; body: UpdateUserRequest; response: User };\n    DELETE: { params: { id: string }; response: void };\n  };\n}\n\n// æå–æ–¹æ³•ç±»å‹\ntype Methods<T> = T extends Record<string, infer M> ? keyof M : never;\n\n// æå–è¯·æ±‚å‚æ•°ç±»å‹\ntype RequestParams<\n  T extends Record<string, any>,\n  P extends keyof T,\n  M extends keyof T[P]\n> = T[P][M] extends { params: infer Params } ? Params : {};\n\n// æå–è¯·æ±‚ä½“ç±»å‹\ntype RequestBody<\n  T extends Record<string, any>,\n  P extends keyof T,\n  M extends keyof T[P]\n> = T[P][M] extends { body: infer Body } ? Body : never;\n\n// æå–å“åº”ç±»å‹\ntype ResponseType<\n  T extends Record<string, any>,\n  P extends keyof T,\n  M extends keyof T[P]\n> = T[P][M] extends { response: infer Response } ? Response : never;\n\n// API å®¢æˆ·ç«¯ç±»å‹\nclass ApiClient<T extends Record<string, any>> {\n  async request<\n    P extends keyof T,\n    M extends Methods<T[P]>\n  >(\n    path: P,\n    method: M,\n    ...args: RequestBody<T, P, M> extends never\n      ? [params?: RequestParams<T, P, M>]\n      : [params: RequestParams<T, P, M>, body: RequestBody<T, P, M>]\n  ): Promise<ResponseType<T, P, M>> {\n    // å®ç°çœç•¥\n    return null as any;\n  }\n}\n\n// ä½¿ç”¨ç¤ºä¾‹\nconst api = new ApiClient<ApiEndpoints>();\n\n// ç±»å‹å®‰å…¨çš„ API è°ƒç”¨\nconst users = await api.request('/users', 'GET'); // User[]\nconst user = await api.request('/users/:id', 'GET', { id: '123' }); // User\nconst newUser = await api.request('/users', 'POST', {}, { name: 'John' }); // User\n```\n\n### è¡¨å•éªŒè¯ç±»å‹\n\n```typescript\n// éªŒè¯è§„åˆ™ç±»å‹\ntype ValidationRule<T> = {\n  required?: boolean;\n  min?: T extends string ? number : T extends number ? number : never;\n  max?: T extends string ? number : T extends number ? number : never;\n  pattern?: T extends string ? RegExp : never;\n  custom?: (value: T) => boolean | string;\n};\n\n// è¡¨å•æ¨¡å¼ç±»å‹\ntype FormSchema<T> = {\n  [K in keyof T]: ValidationRule<T[K]>;\n};\n\n// éªŒè¯é”™è¯¯ç±»å‹\ntype ValidationErrors<T> = {\n  [K in keyof T]?: string[];\n};\n\n// è¡¨å•éªŒè¯å™¨\nclass FormValidator<T extends Record<string, any>> {\n  constructor(private schema: FormSchema<T>) {}\n\n  validate(data: T): ValidationErrors<T> {\n    const errors: ValidationErrors<T> = {};\n\n    for (const key in this.schema) {\n      const rule = this.schema[key];\n      const value = data[key];\n      const fieldErrors: string[] = [];\n\n      if (rule.required && !value) {\n        fieldErrors.push('This field is required');\n      }\n\n      if (value && rule.min !== undefined) {\n        if (typeof value === 'string' && value.length < rule.min) {\n          fieldErrors.push(`Minimum length is ${rule.min}`);\n        }\n        if (typeof value === 'number' && value < rule.min) {\n          fieldErrors.push(`Minimum value is ${rule.min}`);\n        }\n      }\n\n      // æ›´å¤šéªŒè¯é€»è¾‘...\n\n      if (fieldErrors.length > 0) {\n        errors[key] = fieldErrors;\n      }\n    }\n\n    return errors;\n  }\n}\n\n// ä½¿ç”¨ç¤ºä¾‹\ninterface UserForm {\n  name: string;\n  email: string;\n  age: number;\n}\n\nconst validator = new FormValidator<UserForm>({\n  name: { required: true, min: 2 },\n  email: { required: true, pattern: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/ },\n  age: { required: true, min: 18, max: 120 }\n});\n\nconst errors = validator.validate({\n  name: 'John',\n  email: 'john@example.com',\n  age: 25\n});\n```\n\n## æ€§èƒ½è€ƒè™‘\n\n### é¿å…è¿‡åº¦å¤æ‚çš„ç±»å‹\n\n```typescript\n// âŒ è¿‡åº¦å¤æ‚ï¼Œå¯èƒ½å¯¼è‡´ç¼–è¯‘æ€§èƒ½é—®é¢˜\ntype OverlyComplex<T> = T extends infer U\n  ? U extends Record<string, any>\n    ? {\n        [K in keyof U]: U[K] extends infer V\n          ? V extends Record<string, any>\n            ? OverlyComplex<V>\n            : V\n          : never;\n      }\n    : U\n  : never;\n\n// âœ… ç®€åŒ–ç‰ˆæœ¬\ntype Simplified<T> = T extends Record<string, any>\n  ? { [K in keyof T]: Simplified<T[K]> }\n  : T;\n```\n\n### ä½¿ç”¨ç±»å‹æ–­è¨€ä¼˜åŒ–\n\n```typescript\n// åœ¨ç¡®ä¿ç±»å‹å®‰å…¨çš„å‰æä¸‹ä½¿ç”¨æ–­è¨€\nfunction processData<T>(data: unknown): T {\n  // è¿è¡Œæ—¶éªŒè¯\n  if (isValidData(data)) {\n    return data as T;\n  }\n  throw new Error('Invalid data');\n}\n```\n\n## æœ€ä½³å®è·µ\n\n1. **æ¸è¿›å¼é‡‡ç”¨**: ä»ç®€å•ç±»å‹å¼€å§‹ï¼Œé€æ­¥å¼•å…¥é«˜çº§ç‰¹æ€§\n2. **æ–‡æ¡£åŒ–å¤æ‚ç±»å‹**: ä¸ºå¤æ‚çš„ç±»å‹æ·»åŠ æ³¨é‡Šè¯´æ˜\n3. **æµ‹è¯•ç±»å‹**: ä½¿ç”¨ç±»å‹æµ‹è¯•ç¡®ä¿ç±»å‹è¡Œä¸ºæ­£ç¡®\n4. **æ€§èƒ½ç›‘æ§**: å…³æ³¨ç¼–è¯‘æ—¶é—´ï¼Œé¿å…è¿‡åº¦å¤æ‚çš„ç±»å‹\n\n```typescript\n// ç±»å‹æµ‹è¯•ç¤ºä¾‹\ntype Expect<T extends true> = T;\ntype Equal<X, Y> = (<T>() => T extends X ? 1 : 2) extends <T>() => T extends Y ? 1 : 2 ? true : false;\n\n// æµ‹è¯•ç”¨ä¾‹\ntype Test1 = Expect<Equal<ConditionalType<string>, string>>;\ntype Test2 = Expect<Equal<ConditionalType<number>, number>>;\n```\n\n## æ€»ç»“\n\nTypeScript çš„é«˜çº§ç±»å‹ç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›äº†å¼ºå¤§çš„å·¥å…·æ¥æ„å»ºç±»å‹å®‰å…¨çš„åº”ç”¨ï¼š\n\n- **æ¡ä»¶ç±»å‹**: æ ¹æ®æ¡ä»¶é€‰æ‹©ç±»å‹\n- **æ˜ å°„ç±»å‹**: è½¬æ¢ç°æœ‰ç±»å‹\n- **æ¨¡æ¿å­—é¢é‡ç±»å‹**: ç±»å‹å±‚é¢çš„å­—ç¬¦ä¸²æ“ä½œ\n- **å·¥å…·ç±»å‹ç»„åˆ**: æ„å»ºå¤æ‚çš„ç±»å‹é€»è¾‘\n\næŒæ¡è¿™äº›é«˜çº§ç‰¹æ€§ï¼Œèƒ½è®©æˆ‘ä»¬çš„ TypeScript ä»£ç æ›´åŠ å¥å£®å’Œå¯ç»´æŠ¤ã€‚è®°ä½ï¼Œç±»å‹ç³»ç»Ÿçš„ç›®æ ‡æ˜¯å¸®åŠ©æˆ‘ä»¬å†™å‡ºæ›´å¥½çš„ä»£ç ï¼Œè€Œä¸æ˜¯å¢åŠ å¤æ‚æ€§ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¦æ ¹æ®éœ€æ±‚åˆç†ä½¿ç”¨è¿™äº›ç‰¹æ€§ã€‚\n",
      "html": "<h1>TypeScript é«˜çº§ç±»å‹å®æˆ˜æŒ‡å—</h1>\n<p>TypeScript çš„ç±»å‹ç³»ç»Ÿéå¸¸å¼ºå¤§ï¼ŒæŒæ¡é«˜çº§ç±»å‹æŠ€å·§å¯ä»¥è®©æˆ‘ä»¬å†™å‡ºæ›´å®‰å…¨ã€æ›´ä¼˜é›…çš„ä»£ç ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ TypeScript çš„é«˜çº§ç±»å‹ç‰¹æ€§ã€‚</p>\n<h2>æ¡ä»¶ç±»å‹ (Conditional Types)</h2>\n<p>æ¡ä»¶ç±»å‹å…è®¸æˆ‘ä»¬æ ¹æ®æ¡ä»¶é€‰æ‹©ç±»å‹ï¼Œè¯­æ³•ç±»ä¼¼äºä¸‰å…ƒè¿ç®—ç¬¦ã€‚</p>\n<h3>åŸºç¡€è¯­æ³•</h3>\n<pre><code class=\"language-typescript\">type ConditionalType&#x3C;T> = T extends string ? string : number;\n\ntype Test1 = ConditionalType&#x3C;string>; // string\ntype Test2 = ConditionalType&#x3C;number>; // number\n</code></pre>\n<h3>å®é™…åº”ç”¨ï¼šç±»å‹å®ˆå«</h3>\n<pre><code class=\"language-typescript\">type NonNullable&#x3C;T> = T extends null | undefined ? never : T;\n\ntype Example1 = NonNullable&#x3C;string | null>; // string\ntype Example2 = NonNullable&#x3C;number | undefined>; // number\n</code></pre>\n<h3>åˆ†å¸ƒå¼æ¡ä»¶ç±»å‹</h3>\n<p>å½“æ¡ä»¶ç±»å‹ä½œç”¨äºè”åˆç±»å‹æ—¶ï¼Œä¼šåˆ†å¸ƒåˆ°æ¯ä¸ªæˆå‘˜ï¼š</p>\n<pre><code class=\"language-typescript\">type ToArray&#x3C;T> = T extends any ? T[] : never;\n\ntype StrArrOrNumArr = ToArray&#x3C;string | number>; // string[] | number[]\n</code></pre>\n<h2>æ˜ å°„ç±»å‹ (Mapped Types)</h2>\n<p>æ˜ å°„ç±»å‹å¯ä»¥åŸºäºç°æœ‰ç±»å‹åˆ›å»ºæ–°ç±»å‹ã€‚</p>\n<h3>å†…ç½®æ˜ å°„ç±»å‹</h3>\n<pre><code class=\"language-typescript\">// Partial - æ‰€æœ‰å±æ€§å˜ä¸ºå¯é€‰\ntype Partial&#x3C;T> = {\n  [P in keyof T]?: T[P];\n};\n\n// Required - æ‰€æœ‰å±æ€§å˜ä¸ºå¿…éœ€\ntype Required&#x3C;T> = {\n  [P in keyof T]-?: T[P];\n};\n\n// Readonly - æ‰€æœ‰å±æ€§å˜ä¸ºåªè¯»\ntype Readonly&#x3C;T> = {\n  readonly [P in keyof T]: T[P];\n};\n</code></pre>\n<h3>è‡ªå®šä¹‰æ˜ å°„ç±»å‹</h3>\n<pre><code class=\"language-typescript\">// ä¸ºæ‰€æœ‰å±æ€§æ·»åŠ å‰ç¼€\ntype Prefixed&#x3C;T, P extends string> = {\n  [K in keyof T as `${P}${string &#x26; K}`]: T[K];\n};\n\ninterface User {\n  name: string;\n  age: number;\n}\n\ntype PrefixedUser = Prefixed&#x3C;User, 'user_'>;\n// { user_name: string; user_age: number; }\n</code></pre>\n<h2>æ¨¡æ¿å­—é¢é‡ç±»å‹ (Template Literal Types)</h2>\n<p>TypeScript 4.1 å¼•å…¥äº†æ¨¡æ¿å­—é¢é‡ç±»å‹ï¼Œå…è®¸æˆ‘ä»¬åœ¨ç±»å‹å±‚é¢æ“ä½œå­—ç¬¦ä¸²ã€‚</p>\n<h3>åŸºç¡€ç”¨æ³•</h3>\n<pre><code class=\"language-typescript\">type World = \"world\";\ntype Greeting = `hello ${World}`; // \"hello world\"\n</code></pre>\n<h3>å®é™…åº”ç”¨ï¼šäº‹ä»¶ç³»ç»Ÿ</h3>\n<pre><code class=\"language-typescript\">type EventName&#x3C;T extends string> = `on${Capitalize&#x3C;T>}`;\n\ntype ButtonEvents = EventName&#x3C;'click' | 'hover' | 'focus'>;\n// 'onClick' | 'onHover' | 'onFocus'\n\n// äº‹ä»¶å¤„ç†å™¨ç±»å‹\ntype EventHandlers&#x3C;T extends Record&#x3C;string, any>> = {\n  [K in keyof T as EventName&#x3C;string &#x26; K>]?: (event: T[K]) => void;\n};\n\ninterface Events {\n  click: MouseEvent;\n  hover: MouseEvent;\n  focus: FocusEvent;\n}\n\ntype Handlers = EventHandlers&#x3C;Events>;\n// {\n//   onClick?: (event: MouseEvent) => void;\n//   onHover?: (event: MouseEvent) => void;\n//   onFocus?: (event: FocusEvent) => void;\n// }\n</code></pre>\n<h2>å·¥å…·ç±»å‹ç»„åˆ</h2>\n<h3>æ·±åº¦åªè¯»ç±»å‹</h3>\n<pre><code class=\"language-typescript\">type DeepReadonly&#x3C;T> = {\n  readonly [P in keyof T]: T[P] extends object ? DeepReadonly&#x3C;T[P]> : T[P];\n};\n\ninterface NestedObject {\n  user: {\n    profile: {\n      name: string;\n      settings: {\n        theme: string;\n      };\n    };\n  };\n}\n\ntype ReadonlyNested = DeepReadonly&#x3C;NestedObject>;\n// æ‰€æœ‰åµŒå¥—å±æ€§éƒ½å˜ä¸ºåªè¯»\n</code></pre>\n<h3>ç±»å‹å®‰å…¨çš„è·¯å¾„è®¿é—®</h3>\n<pre><code class=\"language-typescript\">type PathKeys&#x3C;T> = {\n  [K in keyof T]: T[K] extends object\n    ? K | `${string &#x26; K}.${PathKeys&#x3C;T[K]>}`\n    : K;\n}[keyof T];\n\ntype GetByPath&#x3C;T, P extends string> = P extends `${infer K}.${infer Rest}`\n  ? K extends keyof T\n    ? GetByPath&#x3C;T[K], Rest>\n    : never\n  : P extends keyof T\n  ? T[P]\n  : never;\n\ninterface Data {\n  user: {\n    profile: {\n      name: string;\n      age: number;\n    };\n    settings: {\n      theme: 'light' | 'dark';\n    };\n  };\n}\n\ntype ValidPaths = PathKeys&#x3C;Data>;\n// 'user' | 'user.profile' | 'user.profile.name' | 'user.profile.age' | 'user.settings' | 'user.settings.theme'\n\nfunction getValue&#x3C;T, P extends PathKeys&#x3C;T>>(obj: T, path: P): GetByPath&#x3C;T, P> {\n  // å®ç°çœç•¥\n  return null as any;\n}\n\nconst data: Data = { /* ... */ };\nconst name = getValue(data, 'user.profile.name'); // string\nconst theme = getValue(data, 'user.settings.theme'); // 'light' | 'dark'\n</code></pre>\n<h2>å®é™…åº”ç”¨æ¡ˆä¾‹</h2>\n<h3>ç±»å‹å®‰å…¨çš„ API å®¢æˆ·ç«¯</h3>\n<pre><code class=\"language-typescript\">// API ç«¯ç‚¹å®šä¹‰\ninterface ApiEndpoints {\n  '/users': {\n    GET: { response: User[] };\n    POST: { body: CreateUserRequest; response: User };\n  };\n  '/users/:id': {\n    GET: { params: { id: string }; response: User };\n    PUT: { params: { id: string }; body: UpdateUserRequest; response: User };\n    DELETE: { params: { id: string }; response: void };\n  };\n}\n\n// æå–æ–¹æ³•ç±»å‹\ntype Methods&#x3C;T> = T extends Record&#x3C;string, infer M> ? keyof M : never;\n\n// æå–è¯·æ±‚å‚æ•°ç±»å‹\ntype RequestParams&#x3C;\n  T extends Record&#x3C;string, any>,\n  P extends keyof T,\n  M extends keyof T[P]\n> = T[P][M] extends { params: infer Params } ? Params : {};\n\n// æå–è¯·æ±‚ä½“ç±»å‹\ntype RequestBody&#x3C;\n  T extends Record&#x3C;string, any>,\n  P extends keyof T,\n  M extends keyof T[P]\n> = T[P][M] extends { body: infer Body } ? Body : never;\n\n// æå–å“åº”ç±»å‹\ntype ResponseType&#x3C;\n  T extends Record&#x3C;string, any>,\n  P extends keyof T,\n  M extends keyof T[P]\n> = T[P][M] extends { response: infer Response } ? Response : never;\n\n// API å®¢æˆ·ç«¯ç±»å‹\nclass ApiClient&#x3C;T extends Record&#x3C;string, any>> {\n  async request&#x3C;\n    P extends keyof T,\n    M extends Methods&#x3C;T[P]>\n  >(\n    path: P,\n    method: M,\n    ...args: RequestBody&#x3C;T, P, M> extends never\n      ? [params?: RequestParams&#x3C;T, P, M>]\n      : [params: RequestParams&#x3C;T, P, M>, body: RequestBody&#x3C;T, P, M>]\n  ): Promise&#x3C;ResponseType&#x3C;T, P, M>> {\n    // å®ç°çœç•¥\n    return null as any;\n  }\n}\n\n// ä½¿ç”¨ç¤ºä¾‹\nconst api = new ApiClient&#x3C;ApiEndpoints>();\n\n// ç±»å‹å®‰å…¨çš„ API è°ƒç”¨\nconst users = await api.request('/users', 'GET'); // User[]\nconst user = await api.request('/users/:id', 'GET', { id: '123' }); // User\nconst newUser = await api.request('/users', 'POST', {}, { name: 'John' }); // User\n</code></pre>\n<h3>è¡¨å•éªŒè¯ç±»å‹</h3>\n<pre><code class=\"language-typescript\">// éªŒè¯è§„åˆ™ç±»å‹\ntype ValidationRule&#x3C;T> = {\n  required?: boolean;\n  min?: T extends string ? number : T extends number ? number : never;\n  max?: T extends string ? number : T extends number ? number : never;\n  pattern?: T extends string ? RegExp : never;\n  custom?: (value: T) => boolean | string;\n};\n\n// è¡¨å•æ¨¡å¼ç±»å‹\ntype FormSchema&#x3C;T> = {\n  [K in keyof T]: ValidationRule&#x3C;T[K]>;\n};\n\n// éªŒè¯é”™è¯¯ç±»å‹\ntype ValidationErrors&#x3C;T> = {\n  [K in keyof T]?: string[];\n};\n\n// è¡¨å•éªŒè¯å™¨\nclass FormValidator&#x3C;T extends Record&#x3C;string, any>> {\n  constructor(private schema: FormSchema&#x3C;T>) {}\n\n  validate(data: T): ValidationErrors&#x3C;T> {\n    const errors: ValidationErrors&#x3C;T> = {};\n\n    for (const key in this.schema) {\n      const rule = this.schema[key];\n      const value = data[key];\n      const fieldErrors: string[] = [];\n\n      if (rule.required &#x26;&#x26; !value) {\n        fieldErrors.push('This field is required');\n      }\n\n      if (value &#x26;&#x26; rule.min !== undefined) {\n        if (typeof value === 'string' &#x26;&#x26; value.length &#x3C; rule.min) {\n          fieldErrors.push(`Minimum length is ${rule.min}`);\n        }\n        if (typeof value === 'number' &#x26;&#x26; value &#x3C; rule.min) {\n          fieldErrors.push(`Minimum value is ${rule.min}`);\n        }\n      }\n\n      // æ›´å¤šéªŒè¯é€»è¾‘...\n\n      if (fieldErrors.length > 0) {\n        errors[key] = fieldErrors;\n      }\n    }\n\n    return errors;\n  }\n}\n\n// ä½¿ç”¨ç¤ºä¾‹\ninterface UserForm {\n  name: string;\n  email: string;\n  age: number;\n}\n\nconst validator = new FormValidator&#x3C;UserForm>({\n  name: { required: true, min: 2 },\n  email: { required: true, pattern: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/ },\n  age: { required: true, min: 18, max: 120 }\n});\n\nconst errors = validator.validate({\n  name: 'John',\n  email: 'john@example.com',\n  age: 25\n});\n</code></pre>\n<h2>æ€§èƒ½è€ƒè™‘</h2>\n<h3>é¿å…è¿‡åº¦å¤æ‚çš„ç±»å‹</h3>\n<pre><code class=\"language-typescript\">// âŒ è¿‡åº¦å¤æ‚ï¼Œå¯èƒ½å¯¼è‡´ç¼–è¯‘æ€§èƒ½é—®é¢˜\ntype OverlyComplex&#x3C;T> = T extends infer U\n  ? U extends Record&#x3C;string, any>\n    ? {\n        [K in keyof U]: U[K] extends infer V\n          ? V extends Record&#x3C;string, any>\n            ? OverlyComplex&#x3C;V>\n            : V\n          : never;\n      }\n    : U\n  : never;\n\n// âœ… ç®€åŒ–ç‰ˆæœ¬\ntype Simplified&#x3C;T> = T extends Record&#x3C;string, any>\n  ? { [K in keyof T]: Simplified&#x3C;T[K]> }\n  : T;\n</code></pre>\n<h3>ä½¿ç”¨ç±»å‹æ–­è¨€ä¼˜åŒ–</h3>\n<pre><code class=\"language-typescript\">// åœ¨ç¡®ä¿ç±»å‹å®‰å…¨çš„å‰æä¸‹ä½¿ç”¨æ–­è¨€\nfunction processData&#x3C;T>(data: unknown): T {\n  // è¿è¡Œæ—¶éªŒè¯\n  if (isValidData(data)) {\n    return data as T;\n  }\n  throw new Error('Invalid data');\n}\n</code></pre>\n<h2>æœ€ä½³å®è·µ</h2>\n<ol>\n<li><strong>æ¸è¿›å¼é‡‡ç”¨</strong>: ä»ç®€å•ç±»å‹å¼€å§‹ï¼Œé€æ­¥å¼•å…¥é«˜çº§ç‰¹æ€§</li>\n<li><strong>æ–‡æ¡£åŒ–å¤æ‚ç±»å‹</strong>: ä¸ºå¤æ‚çš„ç±»å‹æ·»åŠ æ³¨é‡Šè¯´æ˜</li>\n<li><strong>æµ‹è¯•ç±»å‹</strong>: ä½¿ç”¨ç±»å‹æµ‹è¯•ç¡®ä¿ç±»å‹è¡Œä¸ºæ­£ç¡®</li>\n<li><strong>æ€§èƒ½ç›‘æ§</strong>: å…³æ³¨ç¼–è¯‘æ—¶é—´ï¼Œé¿å…è¿‡åº¦å¤æ‚çš„ç±»å‹</li>\n</ol>\n<pre><code class=\"language-typescript\">// ç±»å‹æµ‹è¯•ç¤ºä¾‹\ntype Expect&#x3C;T extends true> = T;\ntype Equal&#x3C;X, Y> = (&#x3C;T>() => T extends X ? 1 : 2) extends &#x3C;T>() => T extends Y ? 1 : 2 ? true : false;\n\n// æµ‹è¯•ç”¨ä¾‹\ntype Test1 = Expect&#x3C;Equal&#x3C;ConditionalType&#x3C;string>, string>>;\ntype Test2 = Expect&#x3C;Equal&#x3C;ConditionalType&#x3C;number>, number>>;\n</code></pre>\n<h2>æ€»ç»“</h2>\n<p>TypeScript çš„é«˜çº§ç±»å‹ç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›äº†å¼ºå¤§çš„å·¥å…·æ¥æ„å»ºç±»å‹å®‰å…¨çš„åº”ç”¨ï¼š</p>\n<ul>\n<li><strong>æ¡ä»¶ç±»å‹</strong>: æ ¹æ®æ¡ä»¶é€‰æ‹©ç±»å‹</li>\n<li><strong>æ˜ å°„ç±»å‹</strong>: è½¬æ¢ç°æœ‰ç±»å‹</li>\n<li><strong>æ¨¡æ¿å­—é¢é‡ç±»å‹</strong>: ç±»å‹å±‚é¢çš„å­—ç¬¦ä¸²æ“ä½œ</li>\n<li><strong>å·¥å…·ç±»å‹ç»„åˆ</strong>: æ„å»ºå¤æ‚çš„ç±»å‹é€»è¾‘</li>\n</ul>\n<p>æŒæ¡è¿™äº›é«˜çº§ç‰¹æ€§ï¼Œèƒ½è®©æˆ‘ä»¬çš„ TypeScript ä»£ç æ›´åŠ å¥å£®å’Œå¯ç»´æŠ¤ã€‚è®°ä½ï¼Œç±»å‹ç³»ç»Ÿçš„ç›®æ ‡æ˜¯å¸®åŠ©æˆ‘ä»¬å†™å‡ºæ›´å¥½çš„ä»£ç ï¼Œè€Œä¸æ˜¯å¢åŠ å¤æ‚æ€§ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¦æ ¹æ®éœ€æ±‚åˆç†ä½¿ç”¨è¿™äº›ç‰¹æ€§ã€‚</p>"
    },
    "_id": "articles/typescript-advanced-types.md",
    "_raw": {
      "sourceFilePath": "articles/typescript-advanced-types.md",
      "sourceFileName": "typescript-advanced-types.md",
      "sourceFileDir": "articles",
      "contentType": "markdown",
      "flattenedPath": "articles/typescript-advanced-types"
    },
    "type": "Article",
    "slug": "typescript-advanced-types",
    "readingTime": {
      "text": "9 min read",
      "minutes": 8.775,
      "time": 526500,
      "words": 1755
    },
    "url": "/articles/typescript-advanced-types"
  }
]