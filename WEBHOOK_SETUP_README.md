# Webhookè‡ªåŠ¨éƒ¨ç½²æœåŠ¡é…ç½®æŒ‡å—\n\næœ¬é¡¹ç›®é…ç½®äº†ä¸€ä¸ªwebhookæœåŠ¡ï¼Œç”¨äºç›‘æ§GitHubä»£ç æ¨é€å¹¶è‡ªåŠ¨é‡æ–°éƒ¨ç½²é¡¹ç›®ã€‚\n\n## ğŸš€ å¿«é€Ÿå¼€å§‹\n\n### 1. éƒ¨ç½²WebhookæœåŠ¡\n\nåœ¨æœ¬åœ°é¡¹ç›®ç›®å½•è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†webhookæœåŠ¡éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼š\n\n```bash\n# ç»™éƒ¨ç½²è„šæœ¬æ‰§è¡Œæƒé™\nchmod +x deploy-webhook.sh\n\n# éƒ¨ç½²webhookæœåŠ¡\n./deploy-webhook.sh\n```\n\n### 2. é…ç½®GitHub Webhook\n\n1. æ‰“å¼€ä½ çš„GitHubä»“åº“\n2. è¿›å…¥ `Settings` > `Webhooks`\n3. ç‚¹å‡» `Add webhook`\n4. é…ç½®å¦‚ä¸‹ï¼š\n   - **Payload URL**: `http://47.116.219.238:3001/webhook`\n   - **Content type**: `application/json`\n   - **Secret**: (å¯é€‰ï¼Œç”¨äºéªŒè¯è¯·æ±‚å®‰å…¨æ€§)\n   - **Events**: é€‰æ‹© \"Just the push event\"\n   - **Active**: å‹¾é€‰\n\n5. ç‚¹å‡» `Add webhook`\n\n### 3. æµ‹è¯•è‡ªåŠ¨éƒ¨ç½²\n\næ¨é€ä»£ç åˆ°mainæˆ–masteråˆ†æ”¯ï¼Œwebhookä¼šè‡ªåŠ¨è§¦å‘éƒ¨ç½²ã€‚\n\n## ğŸ“‹ æœåŠ¡ç«¯ç‚¹\n\nWebhookæœåŠ¡è¿è¡Œåœ¨ `http://47.116.219.238:3001`ï¼Œæä¾›ä»¥ä¸‹ç«¯ç‚¹ï¼š\n\n| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |\n|------|------|------|\n| `/webhook` | POST | GitHub webhookå¤„ç† |\n| `/deploy` | POST | æ‰‹åŠ¨è§¦å‘éƒ¨ç½² |\n| `/status` | GET | æŸ¥çœ‹æœåŠ¡çŠ¶æ€ |\n| `/logs` | GET | æŸ¥çœ‹éƒ¨ç½²æ—¥å¿— |\n| `/` | GET | å¸®åŠ©ä¿¡æ¯ |\n\n## ğŸ§ª æµ‹è¯•å‘½ä»¤\n\n```bash\n# æ£€æŸ¥webhookæœåŠ¡çŠ¶æ€\ncurl http://47.116.219.238:3001/status\n\n# æ‰‹åŠ¨è§¦å‘éƒ¨ç½²\ncurl -X POST http://47.116.219.238:3001/deploy\n\n# æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—\ncurl http://47.116.219.238:3001/logs\n\n# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯\ncurl http://47.116.219.238:3001/\n```\n\n## ğŸ”§ æœåŠ¡ç®¡ç†\n\n### æŸ¥çœ‹æœåŠ¡çŠ¶æ€\n```bash\n# SSHåˆ°æœåŠ¡å™¨\nssh root@47.116.219.238\n\n# æŸ¥çœ‹PM2è¿›ç¨‹\npm2 list\n\n# æŸ¥çœ‹webhookæœåŠ¡æ—¥å¿—\npm2 logs webhook-server\n```\n\n### é‡å¯æœåŠ¡\n```bash\n# é‡å¯webhookæœåŠ¡\npm2 restart webhook-server\n\n# æˆ–è€…é‡æ–°è¿è¡Œå¯åŠ¨è„šæœ¬\ncd /root/my-resume\n./start-webhook.sh\n```\n\n### åœæ­¢æœåŠ¡\n```bash\n# åœæ­¢webhookæœåŠ¡\npm2 stop webhook-server\n\n# åˆ é™¤PM2è¿›ç¨‹\npm2 delete webhook-server\n```\n\n## ğŸ“ éƒ¨ç½²æµç¨‹\n\nå½“æ”¶åˆ°GitHub webhookæ—¶ï¼ŒæœåŠ¡ä¼šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š\n\n1. **éªŒè¯è¯·æ±‚** - æ£€æŸ¥æ˜¯å¦ä¸ºmain/masteråˆ†æ”¯çš„pushäº‹ä»¶\n2. **æ‹‰å–ä»£ç ** - ä»GitHubæ‹‰å–æœ€æ–°ä»£ç \n3. **å®‰è£…ä¾èµ–** - è¿è¡Œ `npm install --legacy-peer-deps`\n4. **æ„å»ºé¡¹ç›®** - è¿è¡Œ `npm run build`\n5. **é‡å¯åº”ç”¨** - ä½¿ç”¨PM2é‡å¯åº”ç”¨æœåŠ¡\n6. **éªŒè¯éƒ¨ç½²** - æ£€æŸ¥åº”ç”¨æ˜¯å¦æ­£å¸¸è¿è¡Œ\n\n## ğŸ”’ å®‰å…¨é…ç½®\n\n### è®¾ç½®Webhookå¯†é’¥ï¼ˆæ¨èï¼‰\n\n1. åœ¨GitHub webhooké…ç½®ä¸­è®¾ç½®Secret\n2. åœ¨æœåŠ¡å™¨ä¸Šè®¾ç½®ç¯å¢ƒå˜é‡ï¼š\n\n```bash\n# ç¼–è¾‘ç¯å¢ƒå˜é‡\necho 'export WEBHOOK_SECRET=\"your-secret-key\"' >> ~/.bashrc\nsource ~/.bashrc\n\n# é‡å¯webhookæœåŠ¡\npm2 restart webhook-server\n```\n\n### é˜²ç«å¢™é…ç½®\n\nç¡®ä¿æœåŠ¡å™¨é˜²ç«å¢™å…è®¸3001ç«¯å£çš„å…¥ç«™è¿æ¥ï¼š\n\n```bash\n# å¦‚æœä½¿ç”¨iptables\niptables -A INPUT -p tcp --dport 3001 -j ACCEPT\n\n# å¦‚æœä½¿ç”¨firewalld\nfirewall-cmd --permanent --add-port=3001/tcp\nfirewall-cmd --reload\n```\n\n## ğŸ› æ•…éšœæ’é™¤\n\n### å¸¸è§é—®é¢˜\n\n1. **ç«¯å£è¢«å ç”¨**\n   ```bash\n   # æŸ¥çœ‹ç«¯å£å ç”¨\n   netstat -tlnp | grep 3001\n   \n   # ç»ˆæ­¢å ç”¨è¿›ç¨‹\n   lsof -ti:3001 | xargs kill -9\n   ```\n\n2. **æƒé™é—®é¢˜**\n   ```bash\n   # ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™\n   chmod +x start-webhook.sh\n   chmod +x deploy-webhook.sh\n   ```\n\n3. **Node.jsç‰ˆæœ¬é—®é¢˜**\n   ```bash\n   # æ£€æŸ¥Node.jsç‰ˆæœ¬\n   node --version\n   \n   # åº”è¯¥æ˜¯v20.xæˆ–æ›´é«˜ç‰ˆæœ¬\n   ```\n\n4. **PM2é—®é¢˜**\n   ```bash\n   # é‡ç½®PM2\n   pm2 kill\n   pm2 start webhook-server.js --name webhook-server\n   ```\n\n### æŸ¥çœ‹æ—¥å¿—\n\n```bash\n# æŸ¥çœ‹webhookæœåŠ¡æ—¥å¿—\npm2 logs webhook-server\n\n# æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—\ntail -f /root/webhook-deploy.log\n\n# æŸ¥çœ‹åº”ç”¨æ—¥å¿—\npm2 logs my-resume-80\n```\n\n## ğŸ“ æ–‡ä»¶è¯´æ˜\n\n- `webhook-server.js` - WebhookæœåŠ¡å™¨ä¸»æ–‡ä»¶\n- `start-webhook.sh` - æœåŠ¡å¯åŠ¨è„šæœ¬\n- `deploy-webhook.sh` - æœ¬åœ°éƒ¨ç½²è„šæœ¬\n- `WEBHOOK_SETUP_README.md` - æœ¬è¯´æ˜æ–‡æ¡£\n\n## ğŸ¯ é«˜çº§é…ç½®\n\n### è‡ªå®šä¹‰éƒ¨ç½²è„šæœ¬\n\nå¯ä»¥ä¿®æ”¹ `webhook-server.js` ä¸­çš„éƒ¨ç½²è„šæœ¬éƒ¨åˆ†ï¼Œæ·»åŠ è‡ªå®šä¹‰çš„éƒ¨ç½²é€»è¾‘ï¼š\n\n```javascript\n// åœ¨executeDeploymentå‡½æ•°ä¸­ä¿®æ”¹deployScriptå˜é‡\nconst deployScript = `\n    set -e\n    cd ${PROJECT_DIR}\n    \n    # ä½ çš„è‡ªå®šä¹‰éƒ¨ç½²é€»è¾‘\n    echo \"å¼€å§‹è‡ªå®šä¹‰éƒ¨ç½²...\"\n    \n    # ä¾‹å¦‚ï¼šè¿è¡Œæµ‹è¯•\n    npm test\n    \n    # ä¾‹å¦‚ï¼šå¤‡ä»½å½“å‰ç‰ˆæœ¬\n    cp -r .next .next.backup\n    \n    # æ ‡å‡†éƒ¨ç½²æµç¨‹...\n`;\n```\n\n### å¤šåˆ†æ”¯æ”¯æŒ\n\nä¿®æ”¹webhookå¤„ç†é€»è¾‘ï¼Œæ”¯æŒä¸åŒåˆ†æ”¯çš„ä¸åŒéƒ¨ç½²ç­–ç•¥ï¼š\n\n```javascript\n// åœ¨webhookå¤„ç†ä¸­æ·»åŠ åˆ†æ”¯åˆ¤æ–­\nif (payload.ref === 'refs/heads/main') {\n    // ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²\n    executeDeployment('github-main');\n} else if (payload.ref === 'refs/heads/develop') {\n    // å¼€å‘ç¯å¢ƒéƒ¨ç½²\n    executeDeployment('github-develop');\n}\n```\n\n## ğŸ“ æ”¯æŒ\n\nå¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š\n\n1. æœåŠ¡å™¨ç½‘ç»œè¿æ¥\n2. GitHub webhooké…ç½®\n3. æœåŠ¡å™¨æ—¥å¿—æ–‡ä»¶\n4. PM2è¿›ç¨‹çŠ¶æ€\n\næˆ–è€…æŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯æ—¥å¿—æ¥è¯Šæ–­é—®é¢˜ã€‚\n